## ðŸ”— MASTER INTEGRATION CHECKLIST
### All 9 Frontend Pages â†” All Backend Endpoints

---

## ðŸ“‹ HOW TO USE THIS CHECKLIST

```
For each page:
  â–¡ = Not started
  â—‘ = In progress
  âœ… = Verified working

Test each endpoint:
  1. Without token      â†’ must get 401
  2. With wrong role    â†’ must get 403
  3. With correct token â†’ must get 200/201/202
  4. Frontend receives  â†’ UI renders correctly
```

---

## ðŸŸ¦ PAGE 1 â€” Dashboard

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/overview
  Called by:   loadOverview()
  Populates:   4 KPI stat cards
  Check:
    â–¡ revenue.value shows in Card 1
    â–¡ revenue.change badge green/red correctly
    â–¡ orders.value shows in Card 2
    â–¡ orders.pending shows below value
    â–¡ users.value shows in Card 3
    â–¡ users.newThisMonth shows below value
    â–¡ lowStock.value shows in Card 4
    â–¡ If lowStock.value > 0:
        Card 4 border turns danger red
        Topbar notification dot appears
    â–¡ Skeleton removed after data loads
    â–¡ Card 4 click navigates to inventory.html

â–¡ GET /api/admin/analytics/orders-by-hour-today
  Called by:   loadHourlyChart()
  Populates:   Left chart (Bar chart)
  Check:
    â–¡ X-axis shows hours from 8AM to now only
    â–¡ Current hour bar is accent cyan color
    â–¡ Past hours are 30% opacity
    â–¡ Average reference line drawn
    â–¡ "Avg" label at right of line
    â–¡ Peak hour quick-stat correct below chart
    â–¡ Quiet hour quick-stat correct below chart
    â–¡ Auto-refreshes every 5 minutes silently
        (no skeleton flash on refresh)

â–¡ GET /api/admin/analytics/sales?period=7d
  Called by:   loadSalesChart()
  Populates:   Right chart (Mixed Bar+Line)
  Check:
    â–¡ Bar = Revenue, Line = Orders
    â–¡ Dual Y-axes present
    â–¡ 7D pill active by default
    â–¡ Clicking 30D re-fetches + re-renders
    â–¡ Clicking 90D re-fetches + re-renders
    â–¡ Only this chart changes on pill click
        (KPI cards do NOT reload)
    â–¡ Old chart destroyed before new renders

â–¡ GET /api/admin/analytics/top-items
  Called by:   loadTopItems()
  Populates:   Bottom-left table
  Check:
    â–¡ Exactly 5 rows shown
    â–¡ Rank 1 = gold badge
    â–¡ Rank 2 = silver badge
    â–¡ Rank 3 = bronze badge
    â–¡ Mini progress bar width = share %
    â–¡ "View All â†’" links to food-management.html

â–¡ GET /api/admin/alerts
  Called by:   loadAlerts()
  Populates:   Bottom-right alerts panel
  Check:
    â–¡ Alert items render with correct dot color
    â–¡ warn  â†’ amber dot with glow
    â–¡ error â†’ red dot with glow
    â–¡ info  â†’ cyan dot with glow
    â–¡ Empty state shows "No alerts right now âœ“"
    â–¡ Max 10 alerts shown

INTEGRATION RULES FOR PAGE 1:
  â–¡ All 5 loads called in parallel via Promise.all
  â–¡ loadOverview() awaited first before charts
  â–¡ hourlyRefreshInterval cleared on beforeunload
  â–¡ JWT decoded for admin name in sidebar
  â–¡ Logout clears admin_token + redirects
```

---

## ðŸŸ¦ PAGE 2 â€” Food Management

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/foods
  Called by:   loadFoods()
  Populates:   Food table
  Check:
    â–¡ All food items render in table
    â–¡ Image shows if image_url present
    â–¡ Placeholder emoji if no image
    â–¡ Category badge correct color per category
    â–¡ Stock number color:
        0       â†’ danger red
        1-9     â†’ warning amber
        10+     â†’ success green
    â–¡ Status badge correct per available field
    â–¡ Availability toggle reflects available state
    â–¡ Skeleton rows removed after load
    â–¡ "Showing X of Y items" count correct

â–¡ POST /api/admin/foods
  Called by:   submitFood() in add mode
  Triggered:   "Add Food" button â†’ modal â†’ Save
  Check:
    â–¡ Form validation fires on submit not on blur
    â–¡ Required fields highlighted red if missing
    â–¡ Error message appears below invalid field
    â–¡ Scroll to first invalid field on fail
    â–¡ Button shows spinner + disabled during call
    â–¡ On 201: modal closes
    â–¡ On 201: new row prepended to table
    â–¡ On 201: success toast appears
    â–¡ On 201: "Showing X of Y" count increments
    â–¡ On 409 conflict: error toast shows
    â–¡ Modal stays open on any error
    â–¡ Image URL preview updates as user types

â–¡ PUT /api/admin/foods/:id
  Called by:   submitFood() in edit mode
  Triggered:   Edit icon â†’ modal pre-filled â†’ Save
  Check:
    â–¡ All fields pre-filled with existing data
    â–¡ Modal title changes to "Edit Food Item"
    â–¡ Button text changes to "Update Food"
    â–¡ Only changed fields sent to API
        (partial update)
    â–¡ On 200: modal closes
    â–¡ On 200: that specific row updated in-place
        (no full table reload)
    â–¡ On 200: success toast appears

â–¡ DELETE /api/admin/foods/:id
  Called by:   confirmDelete()
  Triggered:   Delete icon â†’ confirmation modal
  Check:
    â–¡ Food name appears in modal warning text
    â–¡ "removes from AI recommendation engine"
        message visible
    â–¡ Cancel button closes modal, no action
    â–¡ Confirm button shows spinner during call
    â–¡ On 200: modal closes
    â–¡ On 200: row fades out (opacity 0, height 0)
    â–¡ On 200: row removed from DOM after animation
    â–¡ On 200: success toast appears
    â–¡ On 422 (active orders): error toast
        "Cannot delete â€” pending orders exist"

â–¡ PUT /api/admin/foods/:id/availability
  Called by:   toggleAvailability()
  Triggered:   Toggle switch click in table row
  Check:
    â–¡ Spinner shows inside toggle during call
    â–¡ Toggle non-clickable during call
    â–¡ On 200: toggle state updates in-place
    â–¡ On 200: status badge updates in-place
    â–¡ On error: toggle reverts to previous state
    â–¡ On error: error toast appears

INTEGRATION RULES FOR PAGE 2:
  â–¡ foodsData[] array is master state
  â–¡ All operations update array first then DOM
  â–¡ No full table reload except initial load
  â–¡ editingId = null means add mode
  â–¡ editingId = uuid means edit mode
  â–¡ Escape key closes any open modal
  â–¡ Overlay click closes any open modal
  â–¡ Focus trapped inside modal while open
```

---

## ðŸŸ¦ PAGE 3 â€” Inventory

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/inventory
  Called by:   loadInventory()
  Populates:   Summary strip + table
  Check:
    â–¡ Summary Card 1: total count correct
    â–¡ Summary Card 2: lowStock count correct
    â–¡ Summary Card 3: outOfStock count correct
    â–¡ Card 3 border turns red if outOfStock > 0
    â–¡ Table sorted: Out of Stock first
        then Low then Healthy
    â–¡ Status badge correct per stock levels:
        current = 0         â†’ "Out of Stock" red
        current < reorder   â†’ "Low Stock" amber
        current >= reorder  â†’ "Healthy" green
    â–¡ Last Updated shows relative time
    â–¡ Skeleton rows removed after load
    â–¡ Card 2 click filters table to Low Stock
    â–¡ Card 3 click filters table to Out of Stock

â–¡ PUT /api/admin/inventory/:food_id
  Called by:   saveStock()
  Triggered:   Pencil icon â†’ input â†’ Save button
  Check:
    â–¡ Pencil click converts qty to input
    â–¡ Input pre-filled with current stock
    â–¡ Save + Cancel buttons appear
    â–¡ Pencil icon hides during edit mode
    â–¡ Validation: empty input â†’ shake + toast
    â–¡ Validation: negative number â†’ shake + toast
    â–¡ Validation: decimal â†’ shake + toast
    â–¡ Cancel reverts to display mode unchanged
    â–¡ Save: spinner on button during call
    â–¡ On 200: qty cell reverts to display mode
    â–¡ On 200: status badge recalculates in-place
    â–¡ On 200: row flashes green then fades
    â–¡ On 200: summary strip recounts from memory
        (no extra API call)
    â–¡ On 200: success toast appears
    â–¡ On error: error toast + revert to original

INTEGRATION RULES FOR PAGE 3:
  â–¡ inventoryData[] is master state
  â–¡ Summary strip recount from memory only
      never re-fetch from API after update
  â–¡ Inline edit of one row must not
      affect other rows in edit mode
  â–¡ Search + status filter are client-side
      (no API call on filter)
  â–¡ Results count updates as filters change
```

---

## ðŸŸ¦ PAGE 4 â€” Orders

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/orders
  Called by:   loadOrders('all')
  Populates:   Summary strip + table
  Check:
    â–¡ Summary counts all 4 statuses
    â–¡ Tab badge pills show correct counts
    â–¡ Table renders all orders
    â–¡ Order ID formatted as #ORD-00001
    â–¡ Customer avatar shows correct initials
    â–¡ Items summary: "Item1, Item2 +N more"
    â–¡ Total shows â‚¹ formatted
    â–¡ Status badge correct color per status
    â–¡ Date shows formatted + relative below
    â–¡ Skeleton rows removed after load

â–¡ GET /api/admin/orders?status=pending
  Called by:   loadOrders('pending')
  Triggered:   Pending tab click
  Check:
    â–¡ Only pending orders in table
    â–¡ Empty state if no pending orders
    â–¡ Loading skeleton during fetch
    â–¡ Summary counts still show all statuses
        (not filtered)

â–¡ GET /api/admin/orders?status=completed
  Called by:   loadOrders('completed')
  Triggered:   Completed tab click
  Check: (same as above for completed)

â–¡ GET /api/admin/orders?status=cancelled
  Called by:   loadOrders('cancelled')
  Triggered:   Cancelled tab click
  Check: (same as above for cancelled)

â–¡ PUT /api/admin/orders/:id/status
  Called by:   confirmStatusChange()
  Triggered:   Status dropdown â†’ option â†’ modal
  Check:
    â–¡ Dropdown shows correct options per status:
        Pending   â†’ Mark Completed, Mark Cancelled
        Completed â†’ "Finalized" greyed out
        Cancelled â†’ "Cancelled" greyed out
    â–¡ Selecting option opens confirmation modal
    â–¡ Modal shows order number in accent color
    â–¡ Confirm button color matches target status
    â–¡ Confirm button shows spinner during call
    â–¡ Confirm button disabled during call
    â–¡ On 200: modal closes
    â–¡ On 200: status badge updates in-place
    â–¡ On 200: dropdown button label updates
    â–¡ On 200: summary strip counts update
    â–¡ On 200: tab badge counts update
    â–¡ On 200: if tab-filtered, row fades out
    â–¡ On 200: success toast with order number
    â–¡ On 422 (invalid transition): error toast
    â–¡ Dropdown closes on Escape key
    â–¡ Dropdown closes on outside click

EXPANDABLE ROW:
  â–¡ Chevron click expands row smoothly
  â–¡ Only one row expanded at a time
  â–¡ Expanding new row collapses previous
  â–¡ Expanded row shows item sub-table
  â–¡ Sub-table shows: Item, Qty, Price, Subtotal
  â–¡ Health flag warning shows if any item flagged
  â–¡ Order metadata shows on right column
  â–¡ Shortcut buttons in expanded row work:
      "Mark as Completed" â†’ same flow as dropdown
      "Cancel Order" â†’ same flow as dropdown
  â–¡ "Print Receipt" opens browser print

INTEGRATION RULES FOR PAGE 4:
  â–¡ Tab click = new server fetch (not client filter)
  â–¡ Date/search filter = client-side only
  â–¡ ordersData[] holds current tab's orders
  â–¡ Status change updates 4 UI elements at once:
      badge + dropdown + summary + tab counts
  â–¡ expandedOrderId tracks which row is open
  â–¡ Table re-render preserves expanded row state
```

---

## ðŸŸ¦ PAGE 5 â€” Users

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/users
  Called by:   loadUsers()
  Populates:   Summary strip + table
  Check:
    â–¡ Summary Card 1: total USER count
    â–¡ Summary Card 2: active USER count
    â–¡ Summary Card 3: deactivated count
    â–¡ Summary Card 4: high risk count
    â–¡ Card 4 border amber if highRisk > 0
    â–¡ Table shows only role='USER' accounts
    â–¡ Avatar circle shows correct initials
    â–¡ Role badge correct color per role
    â–¡ Risk badge correct color per level
    â–¡ Risk score shown next to badge
    â–¡ Last Active shows relative time
    â–¡ Deactivated users:
        Name has line-through style
        Row opacity 0.65
        Status badge red
    â–¡ RBAC visibility applied before render:
        ANALYST â†’ read-only banner shown
                  all action buttons hidden
        MANAGER â†’ role-change button hidden
        SUPER_ADMIN â†’ all buttons visible

â–¡ PUT /api/admin/users/:id (role change)
  Called by:   confirmRoleChange()
  Triggered:   Role icon â†’ role modal â†’ Update
  Check:
    â–¡ Only visible to SUPER_ADMIN
    â–¡ 4 role cards render correctly
    â–¡ Current role highlighted
    â–¡ Cannot re-select current role
    â–¡ SUPER_ADMIN warning box appears when
        SUPER_ADMIN card selected
    â–¡ "Update Role" disabled if same role
    â–¡ Spinner during API call
    â–¡ On 200: modal closes
    â–¡ On 200: role badge updates in-place
    â–¡ On 200: success toast with new role
    â–¡ If admin changed OWN role:
        Special toast + page reload after 2s
    â–¡ On 403: error toast
        "Only SUPER_ADMIN can change roles"
    â–¡ On 422 last SUPER_ADMIN: error toast

â–¡ PUT /api/admin/users/:id (status change)
  Called by:   confirmDeactivation()
  Triggered:   Deactivate/Reactivate button
  Check:
    â–¡ Inline popover appears near button
    â–¡ Popover shows user name in warning
    â–¡ Cancel link closes popover, no action
    â–¡ Confirm button triggers API call
    â–¡ Only one popover open at a time
    â–¡ Popover closes on Escape + outside click
    â–¡ On 200 deactivate:
        Status badge â†’ red "Deactivated"
        Name gets line-through style
        Row opacity â†’ 0.65
        Button changes to âœ… Reactivate
        Summary strip counts update
    â–¡ On 200 reactivate: reverse all above
    â–¡ On 422 (deactivating self): error toast
    â–¡ On 422 (last SUPER_ADMIN): error toast

HEALTH MODAL:
  â–¡ ðŸ‘ï¸ button opens health modal
  â–¡ User name, email, avatar in header
  â–¡ SVG risk ring animates on open
  â–¡ Ring color matches risk level
  â–¡ Conditions show as colored tags
  â–¡ "None reported" if no conditions
  â–¡ Dietary preferences show as tags
  â–¡ Order stats: Total, Spent, Avg Value
  â–¡ AI insights: top category, compliance %
  â–¡ Compliance progress bar renders
  â–¡ "View Order History â†’" link works

INTEGRATION RULES FOR PAGE 5:
  â–¡ JWT decoded on load for currentAdminRole
  â–¡ RBAC visibility applied BEFORE any render
  â–¡ Role change and status change are
      separate API calls â€” never combined
  â–¡ Last SUPER_ADMIN protection enforced
      both client AND server side
  â–¡ usersData[] is master state array
  â–¡ All updates surgical â€” no full reload
```

---

## ðŸŸ¦ PAGE 6 â€” Analytics

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/analytics/summary
  Called by:   loadKpiSummary()
  Query:       ?from=&to=
  Check:
    â–¡ All 4 KPI cards populate
    â–¡ Change badges show + or - correctly
    â–¡ Green â†‘ if positive, red â†“ if negative
    â–¡ Re-fetches when Apply button clicked

â–¡ GET /api/admin/analytics/sales
  Called by:   loadSalesChart()
  Query:       ?from=&to=&chart_period=
  Check:
    â–¡ Line chart renders Revenue + Orders
    â–¡ Gradient fill on Revenue line
    â–¡ Dual Y-axes present
    â–¡ Internal period pills work independently
    â–¡ Changing global date + Apply
        does NOT reset internal period pill

â–¡ GET /api/admin/analytics/revenue-by-category
  Called by:   loadRevenuePieChart()
  Check:
    â–¡ All 5 categories always present
    â–¡ Even if value is 0 for a category
    â–¡ Center text shows total revenue
    â–¡ Legend shows value + percentage

â–¡ GET /api/admin/analytics/popular-foods
  Called by:   loadPopularFoodsChart()
  Check:
    â–¡ Horizontal bar chart renders
    â–¡ Sorted descending by order count
    â–¡ Max 10 items shown
    â–¡ Value labels at end of each bar
    â–¡ Tooltip shows name + count + revenue

â–¡ GET /api/admin/analytics/category-heatmap
  Called by:   loadCategoryHeatmap()
  Check:
    â–¡ CSS grid renders (NOT Chart.js)
    â–¡ 7 columns (Monâ€“Sun)
    â–¡ 5 rows (all categories)
    â–¡ Cell color intensity matches volume
    â–¡ Cell shows order count number
    â–¡ Tooltip on hover shows details

â–¡ GET /api/admin/analytics/disease-distribution
  Called by:   loadDiseaseChart()
  Check:
    â–¡ Doughnut renders top 6 conditions
    â–¡ Center shows total user count
    â–¡ Legend shows condition + count + %
    â–¡ No date filter â€” always current data

â–¡ GET /api/admin/analytics/risk-trends
  Called by:   loadRiskTrendChart()
  Check:
    â–¡ 3 overlaid lines (not stacked)
    â–¡ Low â†’ green, Moderate â†’ amber,
        High â†’ red
    â–¡ Light area fill per line
    â–¡ Empty arrays handled gracefully
    â–¡ No crash if no data in range

â–¡ GET /api/admin/analytics/peak-hours
  Called by:   loadPeakHoursChart()
  Check:
    â–¡ 24 bars always present (0â€“23)
    â–¡ Peak hour bar: accent cyan + glow
    â–¡ "Peak time: Xhour" text below chart
    â–¡ Hours shown in 12hr format on axis

â–¡ GET /api/admin/analytics/top-spenders
  Called by:   loadTopSpenders()
  Check:
    â–¡ Ranked list renders (5 items)
    â–¡ Gold/silver/bronze for top 3
    â–¡ Avatar initials show correctly
    â–¡ "View User â†’" link navigates correctly

â–¡ GET /api/admin/analytics/ai-impact
  Called by:   loadAiStats()
  Check:
    â–¡ Recommendations Served count shows
    â–¡ Acceptance Rate progress bar animates
    â–¡ Health Improvement progress bar animates
    â–¡ "Most recommended item" name shows

GLOBAL DATE FILTER:
  â–¡ Default period: 30 days
  â–¡ Preset pills update dateFrom + dateTo
  â–¡ "Custom" reveals From/To date inputs
  â–¡ Apply button re-fetches ALL 10 sections
  â–¡ All 10 calls fired in Promise.all
  â–¡ "Showing data from X to Y" updates
  â–¡ disease-distribution ignores date filter
      (uses current data always)
  â–¡ Export All button downloads analytics

INTEGRATION RULES FOR PAGE 6:
  â–¡ All chart instances stored in state
  â–¡ destroyChart() before every re-render
  â–¡ Chart.js global defaults set once
      before any chart renders
  â–¡ Center text plugin registered globally
  â–¡ Heatmap is pure CSS grid
  â–¡ buildDateParams() used by every endpoint
```

---

## ðŸŸ¦ PAGE 7 â€” AI Monitoring

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/ai/status
  Called by:   loadAiStatus() + pollStatus()
  Check:
    â–¡ Status bar shows correct state:
        "Active"     â†’ green pulsing dot
        "Degraded"   â†’ amber static dot
        "Retraining" â†’ cyan spinning ring
    â–¡ Version number shows
    â–¡ Last trained relative time shows
    â–¡ Total predictions count shows
    â–¡ 4 metric cards populate:
        Accuracy, Precision, Recall, F1
    â–¡ Progress bars animate from 0 on load
    â–¡ Accuracy bar color:
        > 85 â†’ green
        60-85 â†’ amber
        < 60  â†’ red
    â–¡ Polling starts after retrain initiated
    â–¡ pollStatus() calls every 10 seconds
    â–¡ When status returns 'active':
        polling stops
        metrics refresh
        success toast appears

â–¡ GET /api/admin/ai/features
  Called by:   loadFeatureImportanceChart()
  Check:
    â–¡ Horizontal bar chart renders
    â–¡ 8 features maximum
    â–¡ Sorted descending by importance
    â–¡ Value % labels at end of bars
    â–¡ Default features shown if DB empty

â–¡ GET /api/admin/ai/accuracy-history
  Called by:   loadAccuracyTrendChart()
  Check:
    â–¡ Line chart renders training dates
    â–¡ Smooth cyan line
    â–¡ Horizontal dashed reference line at 85%
    â–¡ "Target Accuracy" label on line
    â–¡ Clicking point shows training details
    â–¡ Empty arrays handled (empty chart)

â–¡ GET /api/admin/ai/logs
  Called by:   loadRecommendationLogs()
  Query:       ?page=&limit=20&risk=&action=&period=&search=
  Check:
    â–¡ Table renders with all columns
    â–¡ Confidence pill color correct:
        > 85 â†’ green
        60-85 â†’ amber
        < 60  â†’ red
    â–¡ User action badge correct:
        Accepted    â†’ green
        Rejected    â†’ red
        No Response â†’ muted grey
    â–¡ Reason text truncated at 40 chars
    â–¡ Full reason shows on hover (tooltip)
    â–¡ Pagination controls render
    â–¡ "Page X of Y" indicator correct
    â–¡ Previous/Next buttons work
    â–¡ Page number input + Enter works
    â–¡ Filters re-fetch from page 1
    â–¡ Empty state message correct

â–¡ GET /api/admin/ai/training-history
  Called by:   loadTrainingHistory()
  Check:
    â–¡ Table renders all history rows
    â–¡ Status badge animated for in_progress
    â–¡ Duration formatted as "Xm Ys"
    â–¡ Accuracy delta shown
    â–¡ Triggered by name shows

â–¡ POST /api/admin/ai/retrain
  Called by:   confirmRetrain()
  Triggered:   "Retrain Model" â†’ modal â†’ Confirm
  Check:
    â–¡ Button disabled if already retraining
    â–¡ Modal shows warning about peak hours
    â–¡ Confirm button shows "Initiating..." spinner
    â–¡ On 202: modal closes
    â–¡ On 202: status bar â†’ "Retraining" state
    â–¡ On 202: spinning ring animation starts
    â–¡ Polling begins every 10 seconds
    â–¡ On 409 (already retraining): error toast
    â–¡ Only SUPER_ADMIN sees retrain button
    â–¡ MANAGER/ANALYST get 403 if they try

INTEGRATION RULES FOR PAGE 7:
  â–¡ pollingInterval stored in state
  â–¡ clearInterval on stopPolling()
  â–¡ pollStatus() checks status === 'active'
      to know when to stop
  â–¡ currentFilters{} + currentPage tracked
  â–¡ Filter change resets to page 1
  â–¡ Both featureChart + accuracyChart
      stored and destroyed before re-render
```

---

## ðŸŸ¦ PAGE 8 â€” Reports

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/export/sales/preview
  Called by:   previewReport('sales')
  Check:
    â–¡ Config panel expands on card button click
    â–¡ Other panels collapse when one opens
    â–¡ Date preset buttons work per panel
    â–¡ Checkboxes show/hide sub-options
    â–¡ Preview panel hidden by default
    â–¡ Preview button shows loading state
    â–¡ On 200: preview panel slides open
    â–¡ "Showing first 10 rows. Full report: X"
    â–¡ Preview table builds from columns[] + rows[]
    â–¡ "Total rows: X" shows below table
    â–¡ "Date range: X to Y" shows
    â–¡ "Generated at: timestamp" shows

â–¡ GET /api/admin/export/sales?format=csv
  Called by:   exportReport('sales', 'csv')
  Check:
    â–¡ Export button shows "Preparing export..."
    â–¡ Button disabled during download
    â–¡ Browser download dialog appears
    â–¡ File named: "sales-report-YYYY-MM-DD.csv"
    â–¡ CSV opens correctly in Excel/Sheets
    â–¡ On complete: "âœ“ Downloaded" for 3 seconds
    â–¡ Button resets after 3 seconds
    â–¡ Export logged in Recent Exports table
    â–¡ "Download Again" on logged entry works

â–¡ GET /api/admin/export/sales?format=pdf
  Called by:   exportReport('sales', 'pdf')
  Check:
    â–¡ Same button flow as CSV
    â–¡ File named: "sales-report-YYYY-MM-DD.pdf"
    â–¡ PDF opens with title + table + date

â–¡ GET /api/admin/export/health/preview
â–¡ GET /api/admin/export/health?format=csv
â–¡ GET /api/admin/export/health?format=pdf
  Check: (same flow as sales)
    â–¡ Anonymize toggle: names/emails masked
    â–¡ Risk data preserved when anonymized

â–¡ GET /api/admin/export/inventory/preview
â–¡ GET /api/admin/export/inventory
  Check: (CSV only â€” no PDF option)
    â–¡ Format toggle hidden for inventory
    â–¡ Download is always .csv

RECENT EXPORTS LOG:
  â–¡ Each export appended to sessionStorage
  â–¡ Table shows last 10 exports
  â–¡ Cleared when tab closes
  â–¡ "Download Again" re-triggers same params
  â–¡ Empty state: "No exports yet this session"

INTEGRATION RULES FOR PAGE 8:
  â–¡ getReportConfig() reads all panel inputs
  â–¡ triggerDownload() uses createObjectURL
  â–¡ URL.revokeObjectURL() called after 100ms
  â–¡ Double-submit prevented (exportInProgress flag)
  â–¡ validateConfig() checks required fields
      before any API call is made
  â–¡ Preview and Export use same config params
```

---

## ðŸŸ¦ PAGE 9 â€” Audit Logs

```
ENDPOINTS TO VERIFY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ GET /api/admin/audit/summary
  Called by:   loadSummary()
  Check:
    â–¡ Card 1: total actions all time
    â–¡ Card 2: today's action count
    â–¡ Card 3: unique admins active today
    â–¡ Card 4: "X minutes ago" relative time
    â–¡ Card 4 auto-refreshes every 30 seconds
    â–¡ Skeletons removed after load

â–¡ GET /api/admin/audit/admins
  Called by:   loadAdminList()
  Check:
    â–¡ Admin filter dropdown populated
    â–¡ Each option shows admin name
    â–¡ "All Admins" as default option

â–¡ GET /api/admin/audit
  Called by:   loadLogs() + debouncedFetch()
  Check:
    â–¡ Table renders with all columns
    â–¡ Timestamp formatted + relative below
    â–¡ Admin avatar shows initials
    â–¡ Admin role badge shows below name
    â–¡ Action type badge correct color:
        CREATE        â†’ green
        UPDATE        â†’ cyan
        DELETE        â†’ red
        LOGIN         â†’ purple
        LOGOUT        â†’ muted
        EXPORT        â†’ blue
        RETRAIN       â†’ amber
        STATUS_CHANGE â†’ orange
    â–¡ Target table in monospace pill
    â–¡ Summary text shows correctly
    â–¡ IP address in monospace font
    â–¡ IP click adds to active filter pills
    â–¡ Pagination controls render correctly

SERVER-SIDE FILTERS:
  â–¡ Search input (400ms debounce):
      Filters across summary, action,
      target table, IP, payload text
  â–¡ Admin dropdown: filters by admin_id
  â–¡ Action type dropdown: filters by type
  â–¡ Target table dropdown: filters by table
  â–¡ Date From input: filters from date
  â–¡ Date To input: filters to end of day
  â–¡ IP input: partial match filter
  â–¡ Every filter change = new API call
      (never client-side on this page)
  â–¡ Debounce cancels previous pending call

ACTIVE FILTER PILLS:
  â–¡ Pill appears for each active filter
  â–¡ Format: "admin: John Doe âœ•"
  â–¡ âœ• click removes filter + re-fetches
  â–¡ "Clear All Filters" resets everything

EXPANDABLE PAYLOAD ROW:
  â–¡ Chevron click expands row
  â–¡ Only one row expanded at a time
  â–¡ JSON syntax highlighting:
      Keys      â†’ cyan
      Strings   â†’ green
      Numbers   â†’ amber
      Booleans  â†’ purple
      Null      â†’ muted red
  â–¡ Line numbers on left side
  â–¡ "Copy JSON" button works
  â–¡ Micro-toast "JSON Copied!" appears
  â–¡ Max height 320px with scroll
  â–¡ "No payload data" message if null
  â–¡ For UPDATE actions:
      Diff view appears below JSON
      Changed fields â†’ amber background
      Added fields   â†’ green background
      Removed fields â†’ red strikethrough

PAGINATION:
  â–¡ "Showing Xâ€“Y of Z results" correct
  â–¡ First/Prev/Next/Last buttons work
  â–¡ Max 5 page numbers shown
  â–¡ Jump to page input + Go button works
  â–¡ Per-page selector: 20/50/100
  â–¡ Changing per-page resets to page 1
  â–¡ Auto-refresh toggle works:
      OFF by default
      When ON: re-fetches page 1 every 30s
      Shows "Last refreshed: Xs ago"
      Expanded row state preserved on refresh

INTEGRATION RULES FOR PAGE 9:
  â–¡ ALL filtering is server-side always
  â–¡ debounceTimer clears on every keystroke
  â–¡ currentFilters{} tracks all active filters
  â–¡ renderFilterPills() called after every change
  â–¡ expandedLogId tracks which row is open
  â–¡ Auto-refresh must not reset expandedLogId
  â–¡ syntaxHighlight() built from scratch (regex)
      no external library
  â–¡ renderDiffView() only for action_type=UPDATE
```

---

## ðŸ”’ GLOBAL INTEGRATION RULES (ALL 9 PAGES)

```
AUTH LAYER:
  â–¡ authGuard() runs on every page load
  â–¡ No admin_token â†’ redirect to login
  â–¡ JWT decoded for admin name + role in sidebar
  â–¡ Every API call sends Authorization: Bearer
  â–¡ 401 from any endpoint â†’ redirect to login
  â–¡ 403 from any endpoint â†’ show error toast
      do not redirect

SIDEBAR (ALL PAGES):
  â–¡ Active nav item highlighted per page
  â–¡ Admin name + role shows in footer badge
  â–¡ Avatar initial from JWT payload name
  â–¡ Nav links correct for all 9 pages

TOPBAR (ALL PAGES):
  â–¡ Live clock updates every second
  â–¡ Notification bell shows dot if alerts exist
  â–¡ Sign Out clears token + redirects
  â–¡ Page title correct per page

LOADING STATES (ALL PAGES):
  â–¡ Shimmer skeleton shown before data loads
  â–¡ Skeleton removed immediately on data load
  â–¡ Failed API call â†’ error toast
      skeleton replaced with error state

TOAST NOTIFICATIONS (ALL PAGES):
  â–¡ Success: green âœ… bottom-right
  â–¡ Error:   red âŒ bottom-right
  â–¡ Warn:    amber âš ï¸ bottom-right
  â–¡ Auto-removes after 3.5 seconds
  â–¡ Multiple toasts stack vertically
  â–¡ Never replaces page content

RBAC (ALL PAGES):
  â–¡ ANALYST: can view, cannot write
  â–¡ MANAGER: can view + write (no role changes)
  â–¡ SUPER_ADMIN: full access everywhere
  â–¡ Role detected from JWT on page load
  â–¡ UI elements hidden/shown before render
  â–¡ Backend also enforces independently
      (dual enforcement â€” UI + API)

ERROR HANDLING (ALL PAGES):
  â–¡ Network error â†’ "Connection failed" toast
  â–¡ 400 â†’ show validation errors from response
  â–¡ 401 â†’ redirect to login
  â–¡ 403 â†’ "Insufficient permissions" toast
  â–¡ 404 â†’ "Not found" toast
  â–¡ 409 â†’ show conflict message toast
  â–¡ 422 â†’ show business logic error toast
  â–¡ 500 â†’ "Server error. Try again." toast
  â–¡ No page ever shows a blank white screen
      Always show error state with message

ADMIN CHANGES REFLECT SYSTEM-WIDE:
  â–¡ Food deleted â†’ removed from recommendations
  â–¡ Stock updated â†’ user menu reflects change
  â–¡ Food marked unavailable â†’ excluded from AI
  â–¡ User deactivated â†’ cannot login
  â–¡ Role changed â†’ permissions update immediately
```

---

## âœ… FINAL SIGN-OFF CHECKLIST

```
Before calling the system production-ready:

BACKEND:
  â–¡ All 40+ endpoints return correct HTTP codes
  â–¡ All endpoints return JSON (never HTML)
  â–¡ All write endpoints write audit logs
  â–¡ JWT required on all /api/admin/* routes
  â–¡ CORS locked to frontend origin only
  â–¡ Rate limiting active on write endpoints
  â–¡ Background retrain thread tested
  â–¡ CSV + PDF downloads verified in browser
  â–¡ Database indexes created (see Day 2)
  â–¡ .env file never committed to git

FRONTEND:
  â–¡ All 9 pages connect to real API (no hardcode)
  â–¡ All pages have loading skeletons
  â–¡ All pages have empty states
  â–¡ All pages have error states
  â–¡ Auth guard on every page
  â–¡ RBAC visibility on every page
  â–¡ All chart instances properly destroyed
  â–¡ All intervals cleared on beforeunload
  â–¡ No console errors in production

INTEGRATION:
  â–¡ Admin stock update â†’ user sees change
  â–¡ Admin food delete â†’ recommendation excludes
  â–¡ Admin user deactivate â†’ user loses access
  â–¡ Retrain completes â†’ new accuracy in status
  â–¡ Every admin action â†’ row in audit logs
  â–¡ Audit logs capture correct IP address
  â–¡ Export downloads work in all browsers:
      Chrome âœ… Firefox âœ… Safari âœ… Edge âœ…

SECURITY:
  â–¡ No passwords in any API response
  â–¡ No stack traces in any error response
  â–¡ No wildcard CORS (*) in production
  â–¡ SQL injection impossible (parameterized only)
  â–¡ JWT secret is strong random string
  â–¡ Admin tokens expire in 4 hours (production)
```
