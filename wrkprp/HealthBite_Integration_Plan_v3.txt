??  HealthBite Smart Canteen
Complete Integration Plan
Unified FastAPI Backend  ·  ML Recommendation Engine  ·  Admin + User System
Version 3.0  |  Full Production Specification

SECTION 1 — ARCHITECTURE DECISIONS
1. Core Architecture Decisions
The following decisions were made to unify the User project (FastAPI + SQLite) and the Admin project (Flask + PostgreSQL) into one production-ready application.

DecisionChoiceReasonFrameworkFastAPI (unified)User system already uses FastAPI. More modern, async-native, auto-generates Swagger docs.Database (Dev)SQLiteSimpler local setup. No PostgreSQL install required for development.Database (Prod)PostgreSQLProduction-grade. Switch via DATABASE_URL in .env only.Primary KeysInteger (auto)SQLite-compatible. No UUID complexity. Works on both SQLite and PostgreSQL.Password Hashingpasslib pbkdf2_sha256Already used in user project. Standardize across both systems.Admin RolesUSER / MANAGER / ANALYST / SUPER_ADMINReplaces old ADMIN/USER. Granular RBAC control.MigrationsAlembicSafe schema evolution. create_all() alone is not sufficient for production.Token StrategySeparate tokensuser_token (localStorage: token) vs admin_token. Cannot cross-contaminate.Background TasksFastAPI BackgroundTasksReplaces Flask threading. Cleaner, safer in async context.Food SourceDatabase tableRemove hardcoded FOOD_ITEMS list. Admin manages via Food Management page.Order ItemsOrderItem tableReplace JSON string in items column. Proper relational structure.


SECTION 2 — UNIFIED PROJECT STRUCTURE
2. Complete Folder Structure
All files in one repository. One backend server on port 8000 serves both frontends.

admin/??? backend/?   ??? app.py                   ? FastAPI entry, all routers, startup event, CORS?   ??? config.py                ? Settings from .env (DATABASE_URL, JWT_SECRET etc.)?   ??? database.py              ? SQLAlchemy engine + get_db() dependency?   ??? dependencies.py          ? get_current_user() JWT decode (NO fake-jwt backdoor)?   ??? requirements.txt         ? All Python packages?   ??? .env                     ? Environment variables (gitignored)?   ??? .env.example             ? Template with all variable names?   ??? seed.py                  ? Insert 30 foods + admin user on first run?   ??? alembic/                 ? Database migration files?   ??? models/?   ?   ??? __init__.py          ? Re-export all models?   ?   ??? user.py              ? Integer PK, unified roles, risk fields?   ?   ??? health_profile.py    ? age, bmi, disease, severity, health_values?   ?   ??? food.py              ? image_emoji + image_url, price, sodium, carbs?   ?   ??? inventory.py         ? Integer FK to food, stock, reorder_level?   ?   ??? order.py             ? Integer PK, status, total (not total_price)?   ?   ??? order_item.py        ? food_name snapshot, health_flag Boolean?   ?   ??? daily_log.py         ? water_intake, steps, mood?   ?   ??? audit_log.py         ? payload_before, payload_after JSON strings?   ?   ??? ai_log.py            ? AiRecommendationLog, user_action field?   ?   ??? training_history.py  ? AiModelStatus, AiTrainingHistory?   ??? routes/?   ?   ??? auth.py              ? Unified login (no role field in request)?   ?   ??? health.py            ? Profile CRUD + sync_user_risk()?   ?   ??? menu.py              ? DB-backed menu, order with stock check + flags?   ?   ??? chatbot.py           ? Per-request DB food init (no hardcode)?   ?   ??? analytics.py         ? Real data (no random.randint)?   ?   ??? admin/?   ?       ??? dependencies.py  ? get_current_admin(), require_role()?   ?       ??? audit_helper.py  ? log_action() utility?   ?       ??? dashboard.py     ? 5 endpoints?   ?       ??? foods.py         ? CRUD + availability toggle?   ?       ??? inventory.py     ? list + update stock?   ?       ??? orders.py        ? list + status change?   ?       ??? users.py         ? list + role/status change?   ?       ??? analytics.py     ? 10 endpoints?   ?       ??? ai_monitor.py    ? status, retrain (BackgroundTasks)?   ?       ??? reports.py       ? CSV + PDF via reportlab?   ?       ??? audit.py         ? paginated + server-side filters?   ??? ml_engine/?   ?   ??? recommendation_model.py  ? Random Forest + Rule hybrid scoring?   ?   ??? risk_model.py            ? Health risk prediction?   ?   ??? feature_engineering.py   ? Data preparation for training?   ?   ??? intent_classifier.py     ? NLP chatbot intent detection?   ?   ??? model_loader.py          ? Load .pkl files safely?   ??? utils/?       ??? formatters.py        ? success() and error() response helpers?       ??? pagination.py        ? paginate_query() utility?       ??? validators.py        ? Input sanitization helpers??? admin_frndend/               ? 9 admin pages (existing)?   ??? assets/js/?   ?   ??? admin-base.js        ? Dynamic API URL (not hardcoded localhost)?   ?   ??? auth-guard.js        ? Auth check for every admin page?   ??? pages/*.html             ? All 9 admin pages??? user_frontend/               ? 10 user pages (from smart canteen)    ??? index.html               ? Login + Register    ??? script.js                ? Fixed login bridge for admin roles    ??? full-menu.html           ? Updated to use DB food format    ??? ... (other pages)


SECTION 3 — ML FRAMEWORKS & ALGORITHMS
3. Machine Learning Architecture
The ML system is modular, separated from business logic, and lives entirely in backend/ml_engine/. Services call ML — controllers never touch ML directly.

3.1 ML Location Map
ModuleML Used?Model / AlgorithmWhyAuth / Register? NoNonePure rule-basedHealth Profile? NoBMI formula onlyMathematical calculationFood Recommendation? YesRandom Forest + Rule Engine (Hybrid)Core brain of systemOrders / Inventory? NoInventory rule logicBusiness rules onlyUser Analytics? YesRisk Score + Trend AnalysisPersonalized health insightsAdmin Analytics? YesML performance metrics displayModel monitoring dashboardChatbot? YesTF-IDF + Intent ClassifierNLP intent detectionAI Monitoring? YesRandom Forest retrain pipelineAdmin triggers retrainingReports? Nopandas aggregation onlyData export, no prediction
3.2 scikit-learn (Core ML Framework)
scikit-learn is the primary ML framework providing classification algorithms, ensemble methods, metrics, and model persistence via joblib.
Where UsedWhat It Doesml_engine/recommendation_model.pyRandomForestClassifier — predicts food suitability probability (0–1)ml_engine/risk_model.pyRandomForestClassifier — predicts diabetes/hypertension/obesity risk probabilityml_engine/intent_classifier.pyTF-IDF Vectorizer + Naive Bayes — chatbot intent classificationAdmin ML Monitoring pageReads accuracy, precision, recall, feature importance from trained model
3.3 Hybrid Recommendation Engine (Core Brain)
FILE: backend/ml_engine/recommendation_model.py
Used in: GET /api/menu/intelligent — scores every food item for the current user.

STEP 1 — Medical Rule Filtering (Hard Exclusions):  If user is allergic to ingredient ? score = 0, exclude entirely  If food is unavailable OR stock = 0 ? exclude entirelySTEP 2 — Rule-Based Scoring (RuleScore):  Base score: 100  Diabetes:       sugar == 0  ? +10 | sugar < 5  ? +5 | sugar > 8  ? -20 | sugar > 15 ? -40  Hypertension:   sodium < 300 ? +5 | sodium > 600 ? -15 | sodium > 1000 ? -35  Obesity:        calories < 300 ? +15 | calories > 700 ? -30  Heart Disease:  fat < 5 ? +10 | fat > 20 ? -40 | protein > 25 ? +10  Anemia:         protein < 5g ? -10 (insufficient iron)  No conditions:  protein > 25 ? +5 (general health bonus)  Order history:  user ordered this food before ? +5 (preference bonus)STEP 3 — ML Probability Scoring (MLProbability):  Random Forest model predicts probability food is suitable (0.0 ? 1.0)  Input features: BMI, disease type (encoded), severity, sugar, sodium,                  calories, protein, fat, age, dietary_preferenceSTEP 4 — Final Weighted Score:  ? = 0.6 (rule weight), (1-?) = 0.4 (ML weight)  FinalScore = ? × RuleScore + (1-?) × (MLProbability × 100)  Clamped to range: 0 ? 100STEP 5 — Color Classification:  Green  (score > 80) ? Safe / Recommended  Yellow (score 50–80) ? Caution  Red    (score < 50) ? Avoid / Not Recommended
3.4 Random Forest — Primary ML Model
Used in: Food Recommendation + Health Risk Prediction
  WHY Random Forest:  ? Handles mixed data types: BMI (float), disease type (encoded), sugar (float), allergies (binary)  ? Robust against overfitting on small datasets  ? Provides feature importance ? feeds Admin AI Monitoring feature chart  ? Works well for classification: suitable / not-suitable  Recommendation Model Input Features:  [BMI, disease_encoded, severity_score, food_sugar, food_sodium,   food_calories, food_protein, food_fat, food_carbs, user_age,   dietary_pref_encoded, allergy_flag]  Output: probability food is safe for this user (0.0 ? 1.0)  Risk Prediction Model Input Features:  [BMI, avg_daily_calories, avg_daily_sugar, avg_daily_sodium,   avg_daily_fat, order_count_30d, high_risk_food_count]  Output: probability of Diabetes / Hypertension / Obesity risk (multi-label)
3.5 Naïve Bayes — Baseline Comparison Model
Used in: ml_engine/intent_classifier.py (chatbot) and as baseline comparison during model selection.
  Why Naïve Bayes:  ? Fast and lightweight — suitable for real-time chatbot intent classification  ? Works well for text probability scoring (TF-IDF features)  ? Provides baseline: Naïve Bayes vs Decision Tree vs Random Forest comparison     Random Forest wins on recommendation accuracy ? becomes final model  In Chatbot (Intent Classification):  Input:  TF-IDF vector of user message  Output: Intent class ? greeting / food_safety / recommendation / analytics / disease_advice
3.6 Decision Tree — Explainable Model
Used in: Module 3 comparison + Admin dashboard ML explanation panel.
  Why Decision Tree:  ? Highly explainable — can show exact rule path in admin viva  ? Mimics medical decision rules naturally  ? Admin ML Monitoring can visualize decision path  Example tree logic (for Diabetes user):  IF sugar > 140mg ? Avoid sweets ? score -= 40  IF BMI > 30 ? Avoid high-fat foods ? score -= 30  IF sodium > 1000mg ? Flag for Hypertension ? score -= 35
3.7 Custom Risk Scoring Algorithm
FILE: backend/ml_engine/risk_model.py
Used in: User Analytics page, Admin Analytics disease distribution, Admin Users risk badge.
  Risk Score Formula:  risk_score = (0.3 × normalized_BMI)             + (0.3 × normalized_sugar_intake)             + (0.2 × normalized_sodium_intake)             + (0.2 × order_pattern_score)  order_pattern_score = high_risk_orders / total_orders × 100  Normalization: value / max_value × 100  BMI max: 40, Sugar max: 150g/day, Sodium max: 3000mg/day  Risk Classification:   0 – 40  ? Low    (risk_level = low)  41 – 70  ? Moderate (risk_level = moderate)  71 – 100 ? High   (risk_level = high)  Auto-updated when:  1. User saves health profile (sync_user_risk())  2. Admin retrains AI model  3. User places 10+ new orders (background recalc)
3.8 NLP Chatbot ML
FILE: backend/ml_engine/intent_classifier.py + backend/routes/chatbot.py
  Framework: scikit-learn TF-IDF Vectorizer + Multinomial Naïve Bayes  Pre-trained models saved as .pkl files:    models/intent_classifier.pkl    models/tfidf_vectorizer.pkl  Intent Classes:  ? greeting       "hi", "hello", "hey"  ? food_safety    "is pasta safe for me?", "can I eat pizza?"  ? recommendation "what should I eat?", "suggest lunch"  ? analytics      "my sugar intake", "health report", "my stats"  ? disease_advice "diabetes food", "blood pressure diet"  ? order_status   "where is my order", "track order"  Critical Fix:  chatbot.py MUST initialize HealthChatbot per-request with DB foods:    foods = db.query(FoodItem).filter_by(available=True).all()    food_list = [{"id":f.id, "name":f.name, ...} for f in foods]    engine = HealthChatbot({}, food_list, [])  NOT: chatbot_engine = HealthChatbot({}, FOOD_ITEMS, [])  ? WRONG (hardcoded)
3.9 pandas + NumPy (Data Processing)
LibraryUsed InWhat It Doespandasml_engine/feature_engineering.pyProcess order history, aggregate nutrition intake, prepare training datasetpandasroutes/admin/reports.pyBuild sales / health / inventory DataFrames for CSV exportpandasroutes/admin/analytics.pyDate-grouped revenue trends, weekly nutrition aggregationNumPyml_engine/recommendation_model.pyFeature normalization, matrix operations for scoringNumPyml_engine/risk_model.pyStatistical transformations for risk calculation
3.10 ML Requirements — packages to add
scikit-learn>=1.3.0     ? Random Forest, Naive Bayes, Decision Tree, TF-IDFpandas>=2.0.0           ? Data processing, aggregation, CSV exportnumpy>=1.24.0           ? Numerical operations, feature engineeringjoblib>=1.3.0           ? Model persistence (.pkl save/load)alembic>=1.12.0         ? Database migrations (CRITICAL — create_all not enough)slowapi>=0.1.9          ? Rate limiting on auth endpointsaiofiles>=23.0.0        ? Async file servingpython-multipart>=0.0.6 ? Form data / file uploadsreportlab>=4.0.0        ? PDF generation for reportsfastapi>=0.104.0uvicorn[standard]>=0.24.0sqlalchemy>=2.0.0python-jose[cryptography]>=3.3.0passlib>=1.7.4python-dotenv>=1.0.0psycopg2-binary>=2.9.9  ? PostgreSQL driver (prod only)


SECTION 4 — CRITICAL GAPS FILLED (14 Additions)
4. Additions to Original Plan

Gap 1 — Alembic Migrations (CRITICAL)
create_all() only creates new tables. It NEVER adds columns to existing tables, renames columns, or handles data safely. Alembic is mandatory.
pip install alembicalembic init alembic# Edit alembic.ini: sqlalchemy.url reads from .env# Edit alembic/env.py: import all models, set target_metadata = Base.metadataalembic revision --autogenerate -m "initial_schema"alembic upgrade head# Every time you add a model field:alembic revision --autogenerate -m "add_risk_level_to_user"alembic upgrade head
Gap 2 — Login: Remove Role Field from Request
Current LoginRequest requires role field and validates it against DB. Remove this. Frontend should NOT tell backend what role the user is.
# WRONG (current):class LoginRequest(BaseModel):    email: str    password: str    role: RoleEnum   ? REMOVE THIS# CORRECT (new):class LoginRequest(BaseModel):    email: str    password: str    # role determined from DB, not from client# In login route — remove this check:# if user.role != request.role.value:  ? DELETE#     raise HTTPException(401, "Invalid role")  ? DELETE# Response tells frontend what role the user actually is# Frontend then decides: admin_token vs token, admin vs user redirect
Gap 3 — Health Flag Rules (Complete Table)
User ConditionFood PropertyThresholdFlag TypeDiabetessugar> 15g?? FLAG (health_flag=True)Diabetessugar> 8g?? WARN (score penalty)Diabetessugar= 0g? BONUS (+10 score)Hypertensionsodium> 1000mg?? FLAGHypertensionsodium> 600mg?? WARNObesitycalories> 700?? FLAGObesityfat> 20g?? WARNHeart Diseasefat> 20g?? FLAGHeart Diseaseprotein> 25g? BONUS (+10 score)Anemiaprotein< 5g?? WARN
Gap 4 — Standard Error Response Format
All endpoints must return the same JSON shape. Admin frontend expects: { success, data, message }.
# FILE: backend/utils/formatters.pydef success(data=None, message="Success", status_code=200):    return JSONResponse(status_code=status_code, content={        "success": True,        "message": message,        "data": data    })def error(message: str, code: int = 400):    raise HTTPException(status_code=code, detail={        "success": False,        "message": message    })# Every route returns one of these two. No bare dicts. No FastAPI defaults.
Gap 5 — FastAPI BackgroundTasks for Retrain
# FILE: backend/routes/admin/ai_monitor.py# WRONG (Flask threading — do not use in FastAPI):# thread = threading.Thread(target=_run_retrain_task)# thread.daemon = True# thread.start()# CORRECT (FastAPI BackgroundTasks):from fastapi import BackgroundTasks@router.post("/api/admin/ai/retrain")async def retrain(    background_tasks: BackgroundTasks,    admin = Depends(require_role("SUPER_ADMIN")),    db: Session = Depends(get_db)):    if model_status.status == "retraining":        raise HTTPException(409, "Already retraining")    background_tasks.add_task(run_retrain_task, db)    return success({"status": "retraining"}, status_code=202)
Gap 6 — CORS Production Configuration
# FILE: backend/app.pyimport osALLOWED_ORIGINS = os.getenv(    "ALLOWED_ORIGINS",    "http://localhost:8000,http://127.0.0.1:8000").split(",")app.add_middleware(    CORSMiddleware,    allow_origins=ALLOWED_ORIGINS,  ? NOT ["*"] in production    allow_credentials=True,    allow_methods=["*"],    allow_headers=["*"],)# .env development:ALLOWED_ORIGINS=http://localhost:8000# .env production:ALLOWED_ORIGINS=https://healthbite.yourdomain.com
Gap 7 — Auth Guard for All Pages
# FILE: admin_frndend/assets/js/auth-guard.js (admin pages)(function() {    const token = localStorage.getItem("admin_token");    if (!token) {        window.location.href = "/user_frontend/index.html";        return;    }    // Decode JWT and verify role is not USER    const payload = JSON.parse(atob(token.split(".")[1]));    if (!["SUPER_ADMIN","MANAGER","ANALYST"].includes(payload.role)) {        localStorage.removeItem("admin_token");        window.location.href = "/user_frontend/index.html";    }})();# Include at TOP of every admin page <head>:<script src="../assets/js/auth-guard.js"></script># FILE: user_frontend/auth-guard.js (user pages)(function() {    const token = localStorage.getItem("token");    if (!token) { window.location.href = "/user_frontend/index.html"; }})();
Gap 8 — Email / Password Reset Dev Fallback
# .env variables needed:MAIL_USERNAME=your@gmail.comMAIL_PASSWORD=your-app-passwordMAIL_FROM=your@gmail.comMAIL_ENABLED=false   ? default OFF for development# In forgot-password route:MAIL_ENABLED = os.getenv("MAIL_ENABLED", "false").lower() == "true"if MAIL_ENABLED:    background_tasks.add_task(send_reset_email, email, reset_token)else:    # Development mode: log token to console    print(f"[DEV] Reset token for {email}: {reset_token}")    # Also return it in response so dev can test    return {"message": "Reset token (dev mode)", "token": reset_token}
Gap 9 — Order Status Polling (User Notification)
# When admin changes order status, user needs to know.# Implementation: client-side polling on orders.html# In GET /api/menu/history response, include updated_at per order:{ "id": 1, "status": "completed", "updated_at": "2025-02-24T14:30:00", ... }# Frontend orders.html polls every 30 seconds:let lastStatuses = {};async function pollOrderUpdates() {    const orders = await fetchOrders();    orders.forEach(order => {        if (lastStatuses[order.id] &&            lastStatuses[order.id] !== order.status) {            showToast(`Order #${order.order_number} is now ${order.status}! ??`);        }        lastStatuses[order.id] = order.status;    });}setInterval(pollOrderUpdates, 30000);  // every 30 seconds
Gap 10 — Deactivated User Cannot Login
# FILE: backend/routes/auth.py — add check AFTER finding user:user = db.query(User).filter(User.email == request.email).first()if not user:    raise HTTPException(401, "Invalid credentials")# ADD THIS CHECK:if user.status == "inactive" or user.disabled == 1:    raise HTTPException(401, "Account is deactivated. Contact admin.")# THEN verify password:if not pwd_context.verify(request.password, user.hashed_password):    raise HTTPException(401, "Invalid credentials")
Gap 11 — Startup Event + Health Check Endpoint
# FILE: backend/app.py@app.on_event("startup")async def startup_event():    Base.metadata.create_all(bind=engine)  # safety net only    # Run Alembic first (see Gap 1)    db = SessionLocal()    try:        food_count = db.query(FoodItem).count()        if food_count == 0:            print("[STARTUP] No foods found. Run: python seed.py")        print(f"[STARTUP] HealthBite running — {food_count} foods in DB")    finally:        db.close()@app.get("/health")async def health_check(db: Session = Depends(get_db)):    try:        db.execute(text("SELECT 1"))        return {"status": "ok", "db": "connected", "version": "2.0.0"}    except Exception as e:        return {"status": "error", "db": str(e)}# Also: Swagger docs available at:# http://localhost:8000/docs  ? test all endpoints without Postman# http://localhost:8000/redoc ? alternative docs UI
Gap 12 — Rate Limiting
# pip install slowapi# FILE: backend/app.pyfrom slowapi import Limiter, _rate_limit_exceeded_handlerfrom slowapi.util import get_remote_addressfrom slowapi.errors import RateLimitExceededlimiter = Limiter(key_func=get_remote_address)app.state.limiter = limiterapp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)# Apply to sensitive routes in auth.py:@router.post("/api/auth/login")@limiter.limit("10/minute")  ? 10 login attempts per minuteasync def login(request: Request, ...):@router.post("/api/auth/register")@limiter.limit("5/minute")   ? 5 registrations per minuteasync def register(request: Request, ...):
Gap 13 — Python Logging
# FILE: backend/app.pyimport logginglogging.basicConfig(    level=logging.INFO,    format="%(asctime)s | %(levelname)s | %(name)s | %(message)s")logger = logging.getLogger("healthbite")# Log every admin action in audit_helper.py:logger.info(f"AUDIT | {action_type} | {target_table} | admin:{admin_id}")# Log ML model events in ml_engine:logger.info(f"ML | Retrain complete | accuracy: {accuracy:.2f}")logger.warning(f"ML | Retrain failed | {error}")# Log slow requests (over 1 second):logger.warning(f"SLOW | {path} took {elapsed:.2f}s")
Gap 14 — Complete .env Template
# FILE: backend/.env.example (commit this, not .env)# DatabaseDATABASE_URL=sqlite:///./canteen.db# For PostgreSQL production:# DATABASE_URL=postgresql://user:password@localhost/healthbite# SecurityJWT_SECRET_KEY=change-this-to-64-char-random-string-in-productionJWT_EXPIRE_MINUTES_USER=1440JWT_EXPIRE_MINUTES_ADMIN=480# EnvironmentENVIRONMENT=developmentALLOWED_ORIGINS=http://localhost:8000,http://127.0.0.1:8000# Email (for password reset)MAIL_ENABLED=falseMAIL_USERNAME=MAIL_PASSWORD=MAIL_FROM=# ML Models pathML_MODELS_DIR=./ml_engine/saved_models/# Alpha weight for hybrid scoring (0.6 = 60% rules, 40% ML)RECOMMENDATION_ALPHA=0.6


SECTION 5 — 8 CRITICAL INTEGRATION POINTS
5. Integration Flow Map
Every integration point below must be verified end-to-end before declaring the project complete.

#User ActionAdmin SeesShared DB Table1User registersNew row in Users pageusers2User sets health profile (Diabetes)Disease distribution chart +1, risk badge = moderateusers.conditions, health_profiles3User places order (2x pizza)Order in Orders page (Pending), Inventory stock -2orders, order_items, inventory4Admin marks food unavailableUser menu: item disappears instantlyfood_items.available5Admin marks order CompletedUser order history: shows Completed + toastorders.status6User accepts AI recommendationAI Monitoring: acceptance rate updatesai_recommendation_logs7Admin retrains AI modelUser gets better-scored menu next requestai_model_status, food_recommender.pkl8Any admin actionAudit Logs: timestamped entry with before/afteraudit_logs


SECTION 6 — 5-WEEK BUILD PLAN
6. Week-by-Week Schedule

WEEK 1 — Fix the FoundationMondayPostgreSQL setup + database.py + Alembic init + .env configurationTuesdayRewrite ALL models (User + Order + FoodItem + Inventory + OrderItem + AuditLog + AiRecommendationLog)WednesdayAlembic migration + seed.py (30 foods + admin user) + fix health.py sync_user_risk()ThursdayFix menu.py (DB foods + proper order + stock decrement + health flags)FridayFix analytics.py (real data) + remove backdoor + fix token expiry + test full user flow

WEEK 2 — Build Admin Backend (FastAPI)MondayAdmin folder structure + dependencies.py (RBAC) + audit_helper.py + dashboard.py (5 endpoints)Tuesdayfoods.py (CRUD + toggle) + inventory.py (list + update) + register routers in app.pyWednesdayorders.py (list + status) + users.py (list + role/status) + cross-system testThursdayanalytics.py (all 10 endpoints, real data, date filters)Fridayai_monitor.py (BackgroundTasks retrain) + reports.py (CSV/PDF) + audit.py (paginated filters)

WEEK 3 — Connect FrontendsMondayFix admin-base.js dynamic URL + create auth-guard.js + update all 9 admin page auth guardsTuesdayFix script.js login bridge (admin roles ? admin_token) + serve both frontends from FastAPIWednesdayFix full-menu.html (DB food format) + fix orders.html (OrderItem breakdown) + fix analytics.html (real data)ThursdayIntegration testing: all 8 integration points end-to-endFridayBug fixes from Thursday + RBAC testing all 3 admin roles + edge case testing

WEEK 4 — Real ML + Chatbot IntelligenceMondayBuild ml_engine/ folder + recommendation_model.py (Random Forest + rule hybrid) + scoring algorithmTuesdayFix chatbot.py (per-request DB init) + intent_classifier.py + recommendation action loggingWednesdayAdmin AI Monitoring live data + verify retrain pipeline updates model + accuracy trackingThursdayReports full test (CSV+PDF all 3 types) + Audit logs complete verification + auto-refreshFridayComplete system test: full user journey + full admin journey + all 8 cross-system checks

WEEK 5 — Production HardeningMondaySecurity audit: JWT strength, CORS lockdown, input validation, SQL injection check, rate limitingTuesdayPerformance: DB indexes, response caching (menu 1min, analytics 5min), remove N+1 queriesWednesdayError handling: global handler (no stack traces), all empty states, all loading statesThursdayCross-browser testing (Chrome/Firefox/Safari/Edge) + mobile responsive auditFridayFinal checklist: .env secured, migrations run, seed complete, all tests pass ? DEPLOY READY


SECTION 7 — VERIFICATION PLAN
7. How to Verify the Integration is Complete

7.1 Server Startup Tests
# 1. Import test (no errors):cd backendpython -c "from app import app; print('? App created OK')"# 2. Migration test:alembic upgrade head# 3. Seed test:python seed.pypython -c "from database import SessionLocal; from models.food import FoodItem;  db=SessionLocal(); print(f'? Foods: {db.query(FoodItem).count()}')"# Expected: Foods: 30# 4. Start server:python -m uvicorn app:app --host 0.0.0.0 --port 8000# 5. Health check:curl http://localhost:8000/health# Expected: {"status":"ok","db":"connected","version":"2.0.0"}# 6. Swagger docs (no auth needed):# Open: http://localhost:8000/docs
7.2 Complete Test Suite
Run the dedicated Test Prompt document which covers:
• 60+ API endpoint tests (user + admin)
• 10 frontend page tests (user + admin visual audit)
• 8 end-to-end integration tests
• RBAC security tests (all 3 admin roles)
• Edge case tests (empty states, invalid input, concurrent orders)

7.3 ML Verification
# Verify recommendation scoring is real (not random):# 1. Login as user WITH Diabetes condition# 2. GET /api/menu/intelligent# 3. Find "Donut Assortment" (sugar=48g) ? match_score should be < 20# 4. Find "Grilled Salmon" (sugar=0g) ? match_score should be > 85# Verify chatbot reads DB foods:# 1. Admin adds new food "Mango Smoothie" via Food Management# 2. User asks chatbot: "suggest something with mango"# 3. Chatbot should mention "Mango Smoothie"# 4. If chatbot uses hardcoded list, Mango Smoothie won't appear ? BUG# Verify retrain updates model:# 1. Admin triggers retrain ? GET /api/admin/ai/status shows "retraining"# 2. Wait 35 seconds# 3. GET /api/admin/ai/status ? status = "active", version bumped# 4. GET /api/admin/ai/features ? feature importance updated


SECTION 8 — PRODUCTION READINESS CHECKLIST
8. Final Production Checklist

CategoryItemDone?SecurityJWT_SECRET_KEY is 64+ char random string?SecurityCORS locked to production domain (not *)?SecurityFake-jwt-token backdoor removed?SecurityNo stack traces in API responses?SecurityRate limiting on /auth/login and /auth/register?SecurityNo passwords in any API response?Security.env in .gitignore?DatabaseAlembic migrations run (not just create_all)?Database30 food items seeded?DatabaseAdmin user seeded (admin@healthbite.com)?DatabaseAll DB indexes created on FK columns?BackendAll 40+ endpoints return correct HTTP codes?BackendAll endpoints return JSON (never HTML)?BackendAll write endpoints write audit logs?BackendNo random.randint() in any analytics route?BackendDeactivated user cannot login?BackendFastAPI BackgroundTasks (not threading) for retrain?MLRandom Forest model trained and .pkl saved?MLChatbot initializes with DB foods per-request?MLScoring algorithm uses health flag rules table?MLAiRecommendationLog written per recommendation?FrontendAll user pages have auth guard?FrontendAll admin pages have auth guard?FrontendLogin correctly routes USER vs SUPER_ADMIN/MANAGER/ANALYST?Frontendadmin_token and token are separate localStorage keys?FrontendAdmin logout returns to user login page?FrontendAll charts destroyed before re-render?FrontendAll intervals cleared on page unload?FrontendZero red errors in DevTools console on all pages?IntegrationUser order ? admin inventory decrements?IntegrationAdmin food toggle ? user menu reflects?IntegrationAdmin order complete ? user sees Completed?IntegrationUser health profile ? admin disease chart?IntegrationAll admin actions in audit logs?

Viva Ready Statement
"Our system uses a hybrid recommendation framework combining deterministic medical rules with ensemble machine learning (Random Forest). Health risk prediction uses supervised learning based on user profiles and food intake patterns. The ML layer is fully modular — separated from business logic in backend/ml_engine/ — ensuring scalability and replaceability. The admin and user systems share one unified FastAPI backend and PostgreSQL database, with real-time data flow through shared SQLAlchemy models."
HealthBite Smart Canteen — Complete Integration PlanVersion 3.0
Confidential — HealthBite Development TeamPage 1 of 2
