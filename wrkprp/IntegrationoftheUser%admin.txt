
### HealthBite Smart Canteen ‚Äî Full Integration

---

## üóìÔ∏è WEEK 1 ‚Äî FIX THE FOUNDATION
### Goal: One database, correct models, working data layer

---

### MONDAY ‚Äî Database Migration

```
MORNING (3 hours):

TASK 1: Install PostgreSQL
  Download + install PostgreSQL 16
  Create database:
    CREATE DATABASE healthbite;
    CREATE USER canteen_admin WITH PASSWORD 'yourpass';
    GRANT ALL ON DATABASE healthbite TO canteen_admin;

TASK 2: Update backend/database.py
  REMOVE: sqlite connection
  ADD:
    SQLALCHEMY_DATABASE_URL =
      "postgresql://canteen_admin:yourpass
       @localhost/healthbite"
    engine = create_engine(DATABASE_URL)

TASK 3: Install new packages
  pip install psycopg2-binary
  pip install alembic
  pip install python-dotenv

TASK 4: Update .env file
  DATABASE_URL=postgresql://canteen_admin:
    yourpass@localhost/healthbite
  JWT_SECRET_KEY=very-long-random-secret-here
  JWT_EXPIRE_MINUTES=1440

AFTERNOON (3 hours):

TASK 5: Setup Alembic
  alembic init alembic
  Edit alembic.ini:
    sqlalchemy.url = (read from .env)
  Edit alembic/env.py:
    Import all models
    Set target_metadata = Base.metadata

TASK 6: Test connection
  python -c "from database import engine;
    print('Connected OK')"

DELIVERABLE BY EOD:
  ‚úÖ PostgreSQL running
  ‚úÖ Connection string working
  ‚úÖ Alembic configured
  ‚úÖ Can connect from Python
```

---

### TUESDAY ‚Äî Fix All Models

```
MORNING (4 hours):

TASK 1: Rewrite models.py completely
  Keep existing User, HealthProfile,
    Order, DailyLog
  ADD to User:
    risk_level    String default='low'
    risk_score    Float  default=0.0
    conditions    String default='[]'
    dietary_prefs String default='[]'
    status        String default='active'
    joined_at     DateTime default=now()
    last_active   DateTime nullable

  ADD to Order:
    order_number  Integer autoincrement
    status        String default='pending'
    payment_method String nullable
    delivery_type  String default='pickup'
    special_instructions String nullable
    updated_at    DateTime nullable
  REMOVE from Order:
    items column (replaced by OrderItem)
  RENAME:
    total_price ‚Üí total

TASK 2: Create NEW models

  class OrderItem:
    id          Integer PK
    order_id    FK ‚Üí orders
    food_id     Integer
    food_name   String
    qty         Integer
    unit_price  Float
    subtotal    Float
    health_flag Boolean default=False

  class FoodItem:
    id          Integer PK autoincrement
    name        String unique
    category    String
    calories    Float
    sugar       Float
    protein     Float
    fat         Float default=0
    sodium      Float default=0
    carbs       Float default=0
    price       Float
    image_emoji String default='üçΩÔ∏è'
    description String nullable
    available   Boolean default=True
    created_at  DateTime default=now()
    updated_at  DateTime nullable

  class Inventory:
    id            Integer PK
    food_id       FK ‚Üí food_items UNIQUE
    current_stock Integer default=100
    reorder_level Integer default=10
    last_updated  DateTime default=now()

  class AuditLog:
    id             Integer PK
    admin_id       FK ‚Üí users nullable
    action_type    String
    target_table   String
    target_id      String nullable
    summary        String
    payload        String (JSON)
    payload_before String (JSON) nullable
    payload_after  String (JSON) nullable
    ip_address     String nullable
    user_agent     String nullable
    timestamp      DateTime default=now()

  class AiRecommendationLog:
    id          Integer PK
    user_id     FK ‚Üí users
    food_id     Integer nullable
    food_name   String
    reason      String nullable
    confidence  Float nullable
    user_action String default='no_response'
    created_at  DateTime default=now()

AFTERNOON (2 hours):

TASK 3: Run migration
  alembic revision --autogenerate
    -m "complete_schema_v2"
  alembic upgrade head

TASK 4: Verify all tables created
  Open pgAdmin or psql
  \dt ‚Üí list all tables
  Must see: users, health_profiles,
    orders, order_items, food_items,
    inventory, audit_logs,
    ai_recommendation_logs, daily_logs

DELIVERABLE BY EOD:
  ‚úÖ All tables in PostgreSQL
  ‚úÖ All new columns present
  ‚úÖ Foreign keys correct
  ‚úÖ Migration file saved
```

---

### WEDNESDAY ‚Äî Seed Data + Fix Health Route

```
MORNING (3 hours):

TASK 1: Create seed script
  FILE: backend/scripts/seed_foods.py

  Take all 30 items from old FOOD_ITEMS list
  in menu.py and insert into food_items table:

  FOODS = [
    { name:"Margherita Pizza",
      category:"Meals", price:250,
      calories:650, sugar:8,
      protein:15, sodium:1200,
      carbs:80, image_emoji:"üçï",
      description:"Fresh mozzarella..." },
    ... all 30 items ...
  ]

  for f in FOODS:
    food = FoodItem(**f)
    db.add(food)
    db.flush()
    inv = Inventory(food_id=food.id,
      current_stock=100,
      reorder_level=10)
    db.add(inv)
  db.commit()

  Run: python scripts/seed_foods.py
  Verify: 30 rows in food_items
          30 rows in inventory

TASK 2: Create admin seed script
  FILE: backend/scripts/seed_admin.py
  Create default SUPER_ADMIN user:
    email: admin@healthbite.com
    password: Admin@123
    role: SUPER_ADMIN
    status: active

AFTERNOON (3 hours):

TASK 3: Fix backend/health.py
  AFTER saving health profile
  ADD this code:

  def sync_user_risk(db, user_id, diseases):
    count = len(diseases)
    if count == 0:
      risk_level = 'low'
      risk_score = 10.0
    elif count <= 2:
      risk_level = 'moderate'
      risk_score = 45.0
    else:
      risk_level = 'high'
      risk_score = 75.0

    user = db.query(User).filter_by(
      id=user_id).first()
    user.conditions = json.dumps(diseases)
    user.risk_level = risk_level
    user.risk_score = risk_score
    user.last_active = datetime.now()
    db.commit()

  Call sync_user_risk() after every
  health profile create + update.

TASK 4: Test health profile sync
  Create user ‚Üí set health profile
    with ["Diabetes", "Hypertension"]
  Check users table:
    conditions = '["Diabetes","Hypertension"]'
    risk_level = 'moderate'
    risk_score = 45.0

DELIVERABLE BY EOD:
  ‚úÖ 30 food items in database
  ‚úÖ 30 inventory rows
  ‚úÖ Admin user created
  ‚úÖ Health profile syncs to user table
```

---

### THURSDAY ‚Äî Fix Menu + Order Routes

```
MORNING (4 hours):

TASK 1: Rewrite menu.py GET /intelligent
  REMOVE: FOOD_ITEMS hardcoded list
  ADD: Read from database

  @router.get("/intelligent")
  async def get_intelligent_menu(db, user):
    profile = get_user_profile(db, user.id)
    diseases = json.loads(
      user.conditions or '[]')

    foods = db.query(FoodItem).join(
      Inventory
    ).filter(
      FoodItem.available == True,
      Inventory.current_stock > 0
    ).all()

    results = []
    for food in foods:
      score = ai_engine.score_food(
        food, diseases, profile)
      tag = get_food_tag(food)
      results.append({
        "id":       food.id,
        "name":     food.name,
        "price":    food.price,
        "calories": food.calories,
        "sugar":    food.sugar,
        "protein":  food.protein,
        "image":    food.image_emoji,
        "tag":      tag,
        "match_score": score,
        "stock":    food.inventory.current_stock
      })

    results.sort(
      key=lambda x: x['match_score'],
      reverse=True)
    return results

TASK 2: Rewrite menu.py POST /order
  REMOVE: old simple order creation
  ADD: full order with stock check

  @router.post("/order")
  async def place_order(order_data, db, user):

    # Step 1: Validate all items
    diseases = json.loads(
      user.conditions or '[]')
    items_detail = []

    for item in order_data.items:
      food = db.query(FoodItem).filter_by(
        id=item.food_id).first()
      if not food:
        raise error f"{item.food_id} not found"
      if not food.available:
        raise error f"{food.name} unavailable"
      inv = food.inventory
      if inv.current_stock < item.qty:
        raise error f"{food.name} out of stock"
      items_detail.append((food, inv, item.qty))

    # Step 2: Create order
    total = sum(
      f.price * q for f,_,q in items_detail)
    order = Order(
      user_id=user.id,
      total=total,
      status='pending',
      payment_method=order_data.payment_method
    )
    db.add(order)
    db.flush()

    # Step 3: Create order items + update stock
    for food, inv, qty in items_detail:
      flag = check_health_flag(food, diseases)
      item = OrderItem(
        order_id   = order.id,
        food_id    = food.id,
        food_name  = food.name,
        qty        = qty,
        unit_price = food.price,
        subtotal   = food.price * qty,
        health_flag = flag
      )
      db.add(item)
      inv.current_stock -= qty
      inv.last_updated = datetime.now()

    db.commit()
    return {"order_id": order.id,
            "status": "pending",
            "total": total}

AFTERNOON (2 hours):

TASK 3: Add health flag logic
  def check_health_flag(food, diseases):
    if 'Diabetes' in diseases:
      if food.sugar > 15: return True
    if 'Hypertension' in diseases:
      if food.sodium > 1000: return True
    if 'Obesity' in diseases:
      if food.calories > 700: return True
    if 'Heart Disease' in diseases:
      if food.fat > 20: return True
    return False

TASK 4: Test full order flow
  Login as user
  GET /api/menu/intelligent ‚Üí foods from DB
  POST /api/menu/order ‚Üí creates order
  Check orders table: status='pending'
  Check order_items table: 2 rows
  Check inventory: stock reduced

DELIVERABLE BY EOD:
  ‚úÖ Menu reads from database
  ‚úÖ Orders create properly
  ‚úÖ Stock decrements on order
  ‚úÖ Health flags set correctly
```

---

### FRIDAY ‚Äî Fix Analytics + Security

```
MORNING (3 hours):

TASK 1: Fix analytics.py
  REMOVE: all random.randint() calls
  REWRITE:

  GET /api/analytics/nutrition:
    orders = db.query(Order).join(OrderItem)\
      .filter(Order.user_id == user.id,
              Order.created_at >= 7_days_ago)\
      .all()

    Group by date, sum nutrition values
    from actual order_items

  GET /api/analytics/risk:
    diseases = json.loads(user.conditions or '[]')
    return real risk list based on
      user's actual conditions

  GET /api/analytics/prediction:
    Analyze last 7 days real orders
    Compare against disease limits
    Return real predictions

TASK 2: Remove security backdoor
  FILE: backend/dependencies.py
  DELETE:
    if token == "fake-jwt-token":
      user = db.query(User)...
      return user

TASK 3: Fix token expiry
  FILE: backend/auth.py
  ACCESS_TOKEN_EXPIRE_MINUTES = 1440

AFTERNOON (3 hours):

TASK 4: Fix admin_analytics.py
  REMOVE: hardcoded numbers
  REWRITE: real DB queries

TASK 5: Test entire Week 1 work
  Register new user
  Set health profile (Diabetes)
  Order 3 foods
  Check: stock reduced correctly
  Check: health flags on items with sugar
  Check: analytics shows real data
  Check: user.conditions populated
  Check: user.risk_level = 'moderate'

TASK 6: Fix any bugs found in testing

DELIVERABLE BY EOD:
  ‚úÖ Analytics shows real data
  ‚úÖ Security backdoor removed
  ‚úÖ Token expires in 24 hours
  ‚úÖ Full user flow tested end-to-end
  ‚úÖ Week 1 COMPLETE
```

---
---

## üóìÔ∏è WEEK 2 ‚Äî BUILD ADMIN BACKEND
### Goal: All 9 admin API route groups built in FastAPI

---

### MONDAY ‚Äî Admin Foundation + Dashboard Routes

```
MORNING (3 hours):

TASK 1: Create folder structure
  backend/
  ‚îî‚îÄ‚îÄ admin/
       ‚îú‚îÄ‚îÄ __init__.py
       ‚îú‚îÄ‚îÄ dependencies.py
       ‚îú‚îÄ‚îÄ audit_helper.py
       ‚îú‚îÄ‚îÄ dashboard.py
       ‚îú‚îÄ‚îÄ foods.py
       ‚îú‚îÄ‚îÄ inventory.py
       ‚îú‚îÄ‚îÄ orders.py
       ‚îú‚îÄ‚îÄ users.py
       ‚îú‚îÄ‚îÄ analytics.py
       ‚îú‚îÄ‚îÄ ai_monitor.py
       ‚îú‚îÄ‚îÄ reports.py
       ‚îî‚îÄ‚îÄ audit.py

TASK 2: Create admin/dependencies.py
  async def get_current_admin(
    token = Depends(oauth2_scheme),
    db    = Depends(get_db)
  ):
    user = decode_jwt(token, db)
    if user.role not in [
      'SUPER_ADMIN','MANAGER','ANALYST'
    ]:
      raise HTTPException(403,
        "Admin access required")
    update_last_active(user, db)
    return user

  def require_role(*roles):
    async def checker(
      admin = Depends(get_current_admin)
    ):
      if admin.role not in roles:
        raise HTTPException(403,
          "Insufficient permissions")
      return admin
    return Depends(checker)

  def require_min_role(min_role):
    HIERARCHY = {
      'ANALYST':4, 'MANAGER':3,
      'SUPER_ADMIN':2, 'USER':99
    }
    async def checker(
      admin = Depends(get_current_admin)
    ):
      if HIERARCHY[admin.role] > \
         HIERARCHY[min_role]:
        raise HTTPException(403,
          "Insufficient permissions")
      return admin
    return Depends(checker)

TASK 3: Create admin/audit_helper.py
  def log_action(db, admin_id, action_type,
    target_table, target_id, summary,
    payload=None, before=None,
    after=None, ip=None):
    try:
      log = AuditLog(
        admin_id       = admin_id,
        action_type    = action_type,
        target_table   = target_table,
        target_id      = str(target_id or ''),
        summary        = summary,
        payload        = json.dumps(payload or {}),
        payload_before = json.dumps(before or {}),
        payload_after  = json.dumps(after or {}),
        ip_address     = ip
      )
      db.add(log)
      db.commit()
    except Exception as e:
      print(f"Audit log failed: {e}")
      # Never raise ‚Äî audit failure never
      # breaks the main request

AFTERNOON (3 hours):

TASK 4: Build admin/dashboard.py
  router = APIRouter(prefix="/api/admin")

  GET /overview
  GET /analytics/orders-by-hour-today
  GET /analytics/sales
  GET /analytics/top-items
  GET /alerts

  Same logic as Flask Week 2 Day 1
  but FastAPI syntax

TASK 5: Register in app.py
  from admin.dashboard import router as dash_r
  app.include_router(dash_r)

TASK 6: Test with Postman/curl
  POST /api/auth/login
    email: admin@healthbite.com
    password: Admin@123
  Copy token
  GET /api/admin/overview
    with Authorization: Bearer {token}
  Must return 200 with real data

DELIVERABLE BY EOD:
  ‚úÖ Admin dependencies working
  ‚úÖ Audit helper working
  ‚úÖ Dashboard 5 endpoints live
  ‚úÖ Role check blocks USER role
```

---

### TUESDAY ‚Äî Foods + Inventory Routes

```
MORNING (3 hours):

TASK 1: Build admin/foods.py
  router = APIRouter(prefix="/api/admin")

  GET    /foods         ‚Üí all food items + inventory
  POST   /foods         ‚Üí create food + inventory row
  PUT    /foods/{id}    ‚Üí update food item
  DELETE /foods/{id}    ‚Üí delete (check pending orders)
  PUT    /foods/{id}/availability ‚Üí toggle

  Each write endpoint:
    Validates input
    Calls log_action() after commit
    Returns standardized response

AFTERNOON (3 hours):

TASK 2: Build admin/inventory.py
  GET /inventory       ‚Üí all items + summary
  PUT /inventory/{food_id} ‚Üí update stock

TASK 3: Register both in app.py
  from admin.foods     import router as food_r
  from admin.inventory import router as inv_r
  app.include_router(food_r)
  app.include_router(inv_r)

TASK 4: Test
  POST /api/admin/foods ‚Üí create new food
  GET  /api/admin/foods ‚Üí see it in list
  User opens menu ‚Üí sees new food
  PUT  /api/admin/foods/{id}/availability
    ‚Üí toggle off
  User opens menu ‚Üí food gone

DELIVERABLE BY EOD:
  ‚úÖ Food CRUD working
  ‚úÖ Inventory CRUD working
  ‚úÖ Admin food change reflects on user menu
  ‚úÖ Audit logs written for all changes
```

---

### WEDNESDAY ‚Äî Orders + Users Routes

```
MORNING (3 hours):

TASK 1: Build admin/orders.py
  router = APIRouter(prefix="/api/admin")

  GET /orders          ‚Üí all orders + summary
    Query params: status filter
    Join: User, OrderItem, FoodItem
    Return full order detail

  PUT /orders/{id}/status
    Validates transition:
      only pending ‚Üí completed/cancelled
    Updates status
    Logs audit trail
    Returns updated order

AFTERNOON (3 hours):

TASK 2: Build admin/users.py
  GET /users           ‚Üí all users + stats
    Join: Order for order stats
    Join: AiRecommendationLog for AI stats
    Returns all with health data

  PUT /users/{id}      ‚Üí role OR status change
    Role change: SUPER_ADMIN only
    Status change: any MANAGER+
    Protections:
      Cannot deactivate self
      Cannot remove last SUPER_ADMIN

TASK 3: Register + test
  Place order as user
  Admin sees order as "Pending"
  Admin marks as "Completed"
  User order history shows "Completed"

DELIVERABLE BY EOD:
  ‚úÖ Orders list with full detail
  ‚úÖ Status change working
  ‚úÖ Users list with health data
  ‚úÖ Role/status change working
  ‚úÖ Both sides synced through DB
```

---

### THURSDAY ‚Äî Analytics Routes (All 10)

```
MORNING (4 hours):

TASK 1: Build admin/analytics.py
  All 10 endpoints:

  GET /analytics/summary
    Revenue, orders, avg value, new users
    With change vs previous period

  GET /analytics/sales
    Date-grouped revenue + order count
    Supports ?period=7d/30d/90d

  GET /analytics/revenue-by-category
    5 categories always returned

  GET /analytics/popular-foods
    Top 10 by quantity sold

  GET /analytics/category-heatmap
    5√ó7 matrix (category √ó day of week)

  GET /analytics/disease-distribution
    UNNEST user.conditions
    Count per disease

  GET /analytics/risk-trends
    Group by month + risk_level

  GET /analytics/peak-hours
    24-hour order distribution

  GET /analytics/top-spenders
    Top 5 users by spend

  GET /analytics/ai-impact
    Recommendation stats

AFTERNOON (2 hours):

TASK 2: Register + test
  Seed some test orders for multiple
    days so charts have real data
  Test each endpoint returns real data
  Verify no random() calls anywhere

TASK 3: Test date filtering
  ?from=2025-01-01&to=2025-02-28
  All charts filter correctly

DELIVERABLE BY EOD:
  ‚úÖ All 10 analytics endpoints live
  ‚úÖ Real data in every chart
  ‚úÖ Date filtering working
  ‚úÖ Disease distribution using real conditions
```

---

### FRIDAY ‚Äî AI Monitor + Reports + Audit

```
MORNING (3 hours):

TASK 1: Build admin/ai_monitor.py
  GET  /ai/status           ‚Üí model status
  GET  /ai/features         ‚Üí feature importance
  GET  /ai/accuracy-history ‚Üí training history
  GET  /ai/logs             ‚Üí rec logs paginated
  GET  /ai/training-history ‚Üí past retrains
  POST /ai/retrain          ‚Üí trigger retrain

  For retrain: use asyncio background task
    (FastAPI uses BackgroundTasks)
    from fastapi import BackgroundTasks
    @router.post("/ai/retrain")
    async def retrain(
      background_tasks: BackgroundTasks,
      admin = Depends(require_role('SUPER_ADMIN'))
    ):
      background_tasks.add_task(
        run_retrain_task, db)
      return {"status": "retraining"}

TASK 2: Build admin/reports.py
  6 endpoints: preview + export for
    sales, health, inventory
  CSV using Python csv module
  PDF using reportlab

TASK 3: Build admin/audit.py
  GET /audit/summary ‚Üí counts + last action
  GET /audit/admins  ‚Üí admin filter list
  GET /audit         ‚Üí paginated logs
    All server-side filters

AFTERNOON (3 hours):

TASK 4: Register all remaining routers
  app.include_router(analytics_r)
  app.include_router(ai_r)
  app.include_router(reports_r)
  app.include_router(audit_r)

TASK 5: Test full admin backend
  All 40+ endpoints hit with Postman
  Every endpoint returns real data
  Role protection verified on each

DELIVERABLE BY EOD:
  ‚úÖ All 40+ admin endpoints live
  ‚úÖ Reports generate real CSV + PDF
  ‚úÖ Audit logs written everywhere
  ‚úÖ AI retrain runs in background
  ‚úÖ Week 2 COMPLETE
```

---
---

## üóìÔ∏è WEEK 3 ‚Äî CONNECT FRONTENDS
### Goal: Both user + admin UIs talk to one backend

---

### MONDAY ‚Äî Fix Admin Frontend URLs

```
MORNING (3 hours):

TASK 1: Update API base URL in all admin pages
  In each admin HTML file (all 9 pages)
  Find the API config at top of <script>

  ADD global config file:
  FILE: frontend/admin/assets/js/config.js

    const HOSTNAME = window.location.hostname
      || '127.0.0.1';
    const ADMIN_API = `http://${HOSTNAME}:8000
      /api/admin`;
    const AUTH_API  = `http://${HOSTNAME}:8000
      /api/auth`;

  Link in every admin HTML:
    <script src="../assets/js/config.js"></script>

  Replace ALL hardcoded URLs in admin pages:
    http://localhost:5000/api/admin/...
    ‚Üí ${ADMIN_API}/...

TASK 2: Fix admin auth token key
  Admin pages use: 'admin_token'
  User pages use:  'token'
  Check every admin page sends:
    headers: {
      'Authorization': `Bearer ${
        localStorage.getItem('admin_token')}`
    }

AFTERNOON (3 hours):

TASK 3: Fix admin auth guard on all 9 pages
  Top of every admin page script:
    const adminToken = localStorage
      .getItem('admin_token');
    if (!adminToken) {
      window.location.href =
        '../../user/index.html';
    }

TASK 4: Test admin pages load with real data
  Dashboard ‚Üí KPI cards show real numbers
  Food Management ‚Üí shows DB food items
  Inventory ‚Üí shows real stock levels
  Orders ‚Üí shows real orders

DELIVERABLE BY EOD:
  ‚úÖ All admin pages hit correct API
  ‚úÖ Auth guard on all 9 pages
  ‚úÖ Real data appearing on all pages
```

---

### TUESDAY ‚Äî Fix Login Bridge

```
MORNING (3 hours):

TASK 1: Fix script.js login redirect
  FILE: frontend/user/script.js

  FIND: if (data.role === "ADMIN")
  REPLACE WITH:
    const ADMIN_ROLES = [
      'SUPER_ADMIN','MANAGER','ANALYST'
    ];

    if (ADMIN_ROLES.includes(data.role)) {
      // Store admin token separately
      localStorage.setItem(
        'admin_token', data.token);
      localStorage.setItem(
        'admin_role', data.role);
      localStorage.setItem(
        'admin_name', data.name);
      // Redirect to admin panel
      window.location.href =
        '../admin/pages/dashboard.html';
    } else {
      // Regular user flow
      localStorage.setItem('token', data.token);
      localStorage.setItem('role', data.role);
      // Check if health profile exists
      fetch(`${API_ROOT}/health/check`, ...)
    }

TASK 2: Add admin logout in admin pages
  In every admin page sidebar logout button:
    function adminLogout() {
      localStorage.removeItem('admin_token');
      localStorage.removeItem('admin_role');
      localStorage.removeItem('admin_name');
      window.location.href =
        '../../user/index.html';
    }

TASK 3: Serve both frontends from FastAPI
  FILE: backend/app.py
  ADD:
    app.mount("/user",
      StaticFiles(
        directory="../frontend/user"),
      name="user_frontend")
    app.mount("/admin",
      StaticFiles(
        directory="../frontend/admin"),
      name="admin_frontend")

    @app.get("/")
    async def root():
      return FileResponse(
        "../frontend/user/index.html")

AFTERNOON (3 hours):

TASK 4: Test the complete login flow
  Open: http://localhost:8000
  Login as USER ‚Üí goes to user dashboard
  Login as SUPER_ADMIN ‚Üí goes to admin panel
  Logout from admin ‚Üí back to login page
  Token check: admin_token in localStorage

TASK 5: Test all admin nav links work
  Dashboard ‚Üí Food Management ‚Üí Inventory
  ‚Üí Orders ‚Üí Users ‚Üí Analytics
  ‚Üí AI Monitoring ‚Üí Reports ‚Üí Audit Logs
  All pages load without 404

DELIVERABLE BY EOD:
  ‚úÖ Login correctly routes user vs admin
  ‚úÖ Both frontends served by one server
  ‚úÖ Admin logout returns to login
  ‚úÖ No 404 on any page navigation
```

---

### WEDNESDAY ‚Äî Fix User Frontend Pages

```
MORNING (3 hours):

TASK 1: Fix full-menu.html
  Remove any references to hardcoded food
  Ensure API call returns new DB format:
    food.id (integer, not 101/102)
    food.image_emoji instead of food.image
    food.available check
    food.stock shown

  Fix "Add to Cart" ‚Üí sends food.id
  Fix order submission format:
    items: [{ food_id: X, qty: Y }]
    payment_method: 'cash'

TASK 2: Fix orders.html
  Current shows: items as JSON string
  Change to: proper item breakdown table
    order_items with food_name, qty, price

TASK 3: Fix health-analytics.html
  Remove: charts using random data
  Connect to real endpoints
  Verify charts show actual order history

AFTERNOON (3 hours):

TASK 4: Fix user.html dashboard
  Currently shows static/mock data
  Connect all stats to real API calls

TASK 5: Fix health-assistant.html chatbot
  After recommendation shown:
    Log to AiRecommendationLog
  Add action buttons:
    "Order This" ‚Üí POST recommendation-action
    { action: 'accepted' }

TASK 6: Test user flow end to end
  Register ‚Üí set profile ‚Üí browse menu
  ‚Üí order food ‚Üí view order history
  ‚Üí check analytics ‚Üí chat with bot

DELIVERABLE BY EOD:
  ‚úÖ Menu shows DB food items
  ‚úÖ Orders show item breakdown
  ‚úÖ Analytics shows real data
  ‚úÖ Chatbot logs recommendations
  ‚úÖ Complete user flow works
```

---

### THURSDAY ‚Äî Integration Testing

```
MORNING (4 hours):

TEST 1 ‚Äî User ‚Üí Admin: Registration
  Register new user on user frontend
  Open admin Users page
  ‚úÖ User appears in table
  ‚úÖ joined_at correct
  ‚úÖ risk_level = 'low' (no conditions)

TEST 2 ‚Äî Profile ‚Üí Analytics: Conditions
  User sets conditions: Diabetes + Hypertension
  Open admin Analytics ‚Üí Disease Distribution
  ‚úÖ Diabetes count incremented
  ‚úÖ Hypertension count incremented
  Open admin Users ‚Üí find user
  ‚úÖ risk_level = 'moderate'
  ‚úÖ conditions show in health modal

TEST 3 ‚Äî Order ‚Üí Inventory: Stock
  User orders 3x Margherita Pizza
  Open admin Inventory
  ‚úÖ Margherita Pizza stock reduced by 3
  Open admin Orders
  ‚úÖ Order shows as Pending
  ‚úÖ Order items show correctly
  ‚úÖ Health flag shown if diabetic user
     ordered high-sugar items

TEST 4 ‚Äî Admin ‚Üí User: Food Availability
  Admin toggles "Chocolate Cake" OFF
  User refreshes menu
  ‚úÖ Chocolate Cake not visible
  Admin toggles it ON
  User refreshes menu
  ‚úÖ Chocolate Cake visible again

AFTERNOON (3 hours):

TEST 5 ‚Äî Admin ‚Üí User: Order Status
  Admin marks pending order as Completed
  User opens order history
  ‚úÖ Shows as Completed

TEST 6 ‚Äî AI Recommendations
  User opens menu
  Open admin AI Monitoring ‚Üí Logs
  ‚úÖ Recommendation log entries appear
  User clicks "Order This" on rec
  ‚úÖ Log updates to 'accepted'
  Acceptance rate updates in AI stats

TEST 7 ‚Äî Audit Trail
  Admin adds a food item
  Admin edits stock
  Admin deactivates a user
  Open Audit Logs page
  ‚úÖ 3 entries: CREATE, UPDATE, UPDATE
  ‚úÖ Admin name shown on each
  ‚úÖ Before/After JSON in payload

TEST 8 ‚Äî Analytics Real Data
  Ensure at least 20 orders in DB
  Open admin Analytics page
  ‚úÖ Revenue chart shows real numbers
  ‚úÖ Popular foods chart accurate
  ‚úÖ Heatmap shows real day patterns
  ‚úÖ Peak hours chart correct

DELIVERABLE BY EOD:
  ‚úÖ All 8 integration tests PASSED
  ‚úÖ No hardcoded data anywhere
  ‚úÖ Both sides in sync
```

---

### FRIDAY ‚Äî Bug Fixes + Polish

```
MORNING (3 hours):

TASK 1: Fix all bugs from Thursday tests
  Document every failed test
  Fix one by one
  Re-test each fix

TASK 2: Console error audit
  Open every page (user + admin)
  Check DevTools Console
  Zero red errors allowed

TASK 3: Network tab audit
  Every page: all API calls return 200
  No calls returning 404 or 500
  All responses have correct data shape

AFTERNOON (3 hours):

TASK 4: Edge case testing
  Empty states:
    Orders with no orders
    Menu with all items out of stock
    Analytics with no data in range
    AI logs empty table
  Very long data:
    Food name 100 chars ‚Üí truncates
    Order with 10 items ‚Üí shows correctly

TASK 5: RBAC testing
  Login as ANALYST:
    Cannot add/edit/delete foods
    Cannot change order status
    Cannot deactivate users
    Can view all pages
  Login as MANAGER:
    Can add/edit/delete foods
    Cannot change user roles
  Login as SUPER_ADMIN:
    Everything accessible

DELIVERABLE BY EOD:
  ‚úÖ All bugs fixed
  ‚úÖ Zero console errors
  ‚úÖ All RBAC rules enforced
  ‚úÖ Edge cases handled
  ‚úÖ Week 3 COMPLETE
```

---
---

## üóìÔ∏è WEEK 4 ‚Äî REAL AI + CHATBOT UPGRADE
### Goal: Make AI system actually intelligent with real data

---

### MONDAY ‚Äî Fix AI Recommendation Engine

```
MORNING (4 hours):

TASK 1: Upgrade chatbot_engine.py
  Connect to real food database
  Remove hardcoded FOOD_ITEMS parameter
  Read foods from DB at query time

  Add real scoring logic:
    def score_food(food, user_diseases,
                   user_history):
      score = 100.0

      for disease in user_diseases:
        if disease == 'Diabetes':
          if food.sugar > 15:
            score -= 40
          elif food.sugar > 8:
            score -= 20
          elif food.sugar == 0:
            score += 10

        if disease == 'Hypertension':
          if food.sodium > 1000:
            score -= 35
          elif food.sodium > 600:
            score -= 15

        if disease == 'Obesity':
          if food.calories > 700:
            score -= 30
          elif food.calories < 300:
            score += 15
            
        if disease == 'Heart Disease':
          if food.fat > 20:
            score -= 40
          elif food.protein > 25:
            score += 10

      # Boost if ordered before + liked
      if food.id in user_history:
        score += 5

      return max(0, min(100, score))

AFTERNOON (2 hours):

TASK 2: Fix GET /api/menu/intelligent
  Use new score_food() function
  Return foods sorted by real score
  Include confidence: score/100

TASK 3: Log every recommendation
  After scoring, for top 5 returned:
    Create AiRecommendationLog:
      user_id = current_user.id
      food_id = food.id
      food_name = food.name
      confidence = score/100
      reason = build_reason(food, diseases)

  def build_reason(food, diseases):
    reasons = []
    for d in diseases:
      if d == 'Diabetes' and food.sugar < 5:
        reasons.append("Low sugar for Diabetes")
      if d == 'Hypertension' and
        food.sodium < 500:
        reasons.append("Low sodium for BP")
    return ', '.join(reasons) or "Good nutrition profile"

DELIVERABLE BY EOD:
  ‚úÖ Real scoring based on conditions
  ‚úÖ Every recommendation logged
  ‚úÖ Reasons generated per disease
```

---

### TUESDAY ‚Äî Fix Chatbot Intelligence

```
MORNING (3 hours):

TASK 1: Connect chatbot to real food DB
  When user asks "is pizza safe for me":
    Query FoodItem WHERE name LIKE '%pizza%'
    Run score_food() against that food
    Return real analysis, not hardcoded text

TASK 2: Connect chatbot to real order history
  When user asks "my analytics" or "my stats":
    Query real orders for this user
    Calculate real: avg calories, sugar trends
    Return real insights

TASK 3: Fix chatbot recommendation logging
  When chatbot recommends a food:
    Create AiRecommendationLog entry
  When user clicks "Order This" in chat:
    Update log.user_action = 'accepted'

AFTERNOON (3 hours):

TASK 4: Add POST /api/chatbot/recommendation-action
  Body: { log_id, action }
  Update AiRecommendationLog.user_action
  Used by chatbot UI "Order This" button

TASK 5: Test chatbot with real data
  User with Diabetes:
    Ask: "what should I eat?"
    ‚Üí Must recommend low-sugar foods
    ‚Üí Must warn about high-sugar items
  User with no conditions:
    Ask: "what should I eat?"
    ‚Üí General healthy recommendations

DELIVERABLE BY EOD:
  ‚úÖ Chatbot reads real food from DB
  ‚úÖ Analysis based on real conditions
  ‚úÖ Real stats in analytics responses
  ‚úÖ Recommendation actions logged
```

---

### WEDNESDAY ‚Äî Admin AI Monitoring Live Data

```
MORNING (3 hours):

TASK 1: Verify AI Monitoring page live
  GET /api/admin/ai/logs
    ‚úÖ Shows real recommendation logs
    ‚úÖ User names correct
    ‚úÖ Food names correct
    ‚úÖ Confidence scores real

  GET /api/admin/analytics/ai-impact
    ‚úÖ Acceptance rate calculated from real logs
    ‚úÖ Health improvement rate real
    ‚úÖ Most recommended food real

TASK 2: Fix AI model status table
  Create AiModelStatus if not exists:
    STATUS: active
    VERSION: v1.0.0
    ACCURACY: 87.5
    LAST_TRAINED: today

TASK 3: Test retrain flow end-to-end
  Admin triggers retrain
  Status ‚Üí Retraining (spinning)
  Frontend polls every 10 seconds
  After 30s: Status ‚Üí Active
  New accuracy shown
  Feature importance updated

AFTERNOON (3 hours):

TASK 4: Connect real .pkl models to retrain
  In retrain background task:
    Load existing food_recommender.pkl
    Get new training data from orders DB
    Retrain model on real data
    Save new .pkl
    Update AiModelStatus

  If ML pipeline too complex:
    Keep simulation for now
    Document for future sprint

TASK 5: Test full AI monitoring page
  All 6 sections show real data
  Filters on logs page work
  Pagination works
  Feature chart renders

DELIVERABLE BY EOD:
  ‚úÖ AI monitoring fully connected
  ‚úÖ Retrain flow works end-to-end
  ‚úÖ Real recommendation data visible
```

---

### THURSDAY ‚Äî Reports + Audit Verification

```
MORNING (3 hours):

TASK 1: Test all report exports
  Sales Report Preview:
    ‚úÖ Shows real orders
    ‚úÖ "Showing first 10 rows"
    ‚úÖ Correct date range

  Sales Report CSV Download:
    ‚úÖ File downloads as .csv
    ‚úÖ Opens correctly in Excel
    ‚úÖ Real order data inside

  Sales Report PDF Download:
    ‚úÖ File downloads as .pdf
    ‚úÖ Opens with title + table
    ‚úÖ Professional formatting

  Health Report:
    ‚úÖ Shows real users + conditions
    ‚úÖ Anonymize toggle works
    ‚úÖ CSV + PDF both work

  Inventory Report:
    ‚úÖ Shows real stock levels
    ‚úÖ Status column correct
    ‚úÖ CSV downloads

AFTERNOON (3 hours):

TASK 2: Test audit logs completely
  Filter by action type: DELETE
    ‚úÖ Only DELETE actions shown
  Filter by admin name:
    ‚úÖ Only that admin's actions
  Search "food":
    ‚úÖ All food-related actions shown
  Date range filter:
    ‚úÖ Only logs in range shown
  Expand a log row:
    ‚úÖ JSON payload visible
    ‚úÖ Syntax highlighting works
    ‚úÖ Before/After diff for UPDATE
    ‚úÖ Copy JSON button works

TASK 3: Verify auto-refresh
  Toggle auto-refresh ON
  Perform an admin action
  Wait 30 seconds
  ‚úÖ New log appears without manual refresh

DELIVERABLE BY EOD:
  ‚úÖ All 3 report types download correctly
  ‚úÖ All audit filters working
  ‚úÖ Payload viewer working
  ‚úÖ Auto-refresh working
```

---

### FRIDAY ‚Äî Week 4 Complete Review

```
ALL DAY:

Run complete system test:

  PHASE 1: User journey
  ‚ñ° Register new user
  ‚ñ° Set health profile (2 conditions)
  ‚ñ° Browse intelligent menu
    (scores based on conditions)
  ‚ñ° Order 3 items (1 with health flag)
  ‚ñ° Chat with bot about diet
  ‚ñ° View order history
  ‚ñ° View health analytics (real data)

  PHASE 2: Admin journey
  ‚ñ° Login as SUPER_ADMIN
  ‚ñ° Dashboard: see new user + order
  ‚ñ° Food Management: add new food
  ‚ñ° Inventory: adjust stock
  ‚ñ° Orders: complete the order
  ‚ñ° Users: view user health modal
  ‚ñ° Analytics: verify all charts real
  ‚ñ° AI Monitoring: check rec logs
  ‚ñ° Reports: download all 3 types
  ‚ñ° Audit: verify all actions logged

  PHASE 3: Cross-system checks
  ‚ñ° User sees order as Completed
  ‚ñ° New food visible on user menu
  ‚ñ° Stock reduced from order
  ‚ñ° Disease in distribution chart
  ‚ñ° Chatbot recommends correctly

DELIVERABLE BY EOD:
  ‚úÖ Complete system working
  ‚úÖ Both sides fully integrated
  ‚úÖ AI recommendations real
  ‚úÖ All data flows verified
  ‚úÖ Week 4 COMPLETE
```

---
---

## üóìÔ∏è WEEK 5 ‚Äî PRODUCTION HARDENING
### Goal: Secure, fast, ready for real users

---

### MONDAY ‚Äî Security Audit

```
ALL DAY:

TASK 1: JWT Security
  ‚ñ° Secret key: 64+ character random string
  ‚ñ° Stored only in .env (not in code)
  ‚ñ° Different secret for dev vs prod
  ‚ñ° Token expiry: 24h user, 8h admin
  ‚ñ° No fake-jwt-token backdoor (confirm removed)

TASK 2: CORS Lockdown
  FILE: backend/app.py
  CHANGE:
    allow_origins=["*"]
  TO:
    allow_origins=[
      "http://localhost:8000",
      "https://yourdomain.com"
    ]

TASK 3: Input validation everywhere
  All POST/PUT endpoints:
    Check required fields present
    Check string lengths reasonable
    Check numbers in valid range
    Return clear error messages

TASK 4: SQL injection check
  All DB queries use ORM (SQLAlchemy)
  No raw string SQL anywhere
  No f-strings in SQL queries

TASK 5: Password security
  ‚ñ° bcrypt/pbkdf2 hashing (already done)
  ‚ñ° No passwords in any API response
  ‚ñ° No passwords in any log
  ‚ñ° Password strength enforced on register

TASK 6: Rate limiting
  pip install slowapi
  Add rate limits:
    POST /api/auth/login:    10/minute
    POST /api/auth/register: 5/minute
    All /api/admin/*:        100/minute

DELIVERABLE:
  ‚úÖ Security checklist complete
  ‚úÖ No vulnerabilities found
```

---

### TUESDAY ‚Äî Performance Optimization

```
ALL DAY:

TASK 1: Add database indexes
  CREATE INDEX idx_orders_user_id
    ON orders(user_id);
  CREATE INDEX idx_orders_status
    ON orders(status);
  CREATE INDEX idx_orders_created_at
    ON orders(created_at);
  CREATE INDEX idx_audit_admin_id
    ON audit_logs(admin_id);
  CREATE INDEX idx_audit_timestamp
    ON audit_logs(timestamp);
  CREATE INDEX idx_ai_logs_user_id
    ON ai_recommendation_logs(user_id);

TASK 2: Add response caching
  pip install fastapi-cache2
  Cache: menu items (1 min)
  Cache: analytics summary (5 min)
  Cache: disease distribution (10 min)
  Do NOT cache: orders, inventory, users

TASK 3: Optimize slow queries
  Test each endpoint response time
  Any endpoint over 500ms:
    Add .options(joinedload(...))
    Remove N+1 query patterns
    Add pagination where missing

TASK 4: Frontend optimization
  All admin pages:
    Chart.js loaded from CDN once
    Not duplicated across pages
  Images: lazy loading
  Font: preconnect to Google Fonts

DELIVERABLE:
  ‚úÖ All endpoints under 500ms
  ‚úÖ Database indexes added
  ‚úÖ No N+1 queries
```

---

### WEDNESDAY ‚Äî Error Handling

```
ALL DAY:

TASK 1: Global error handler in FastAPI
  @app.exception_handler(Exception)
  async def global_handler(req, exc):
    # Log error internally
    print(f"Error: {exc}")
    # Return safe message to client
    return JSONResponse(
      status_code=500,
      content={"success": False,
               "message": "Server error"})

  No stack traces in API responses ever.

TASK 2: Frontend error handling
  Every fetch() call in every page:
    try/catch wrapping
    Network error ‚Üí "Connection failed" toast
    401 ‚Üí redirect to login
    403 ‚Üí "Insufficient permissions" toast
    422 ‚Üí show validation error toast
    500 ‚Üí "Server error. Try again." toast
    No white blank screens anywhere

TASK 3: Empty state handling
  Every table on every page:
    Has empty state message
    Has appropriate icon
    Has action button if applicable

TASK 4: Loading state handling
  Every data load:
    Shows skeleton/spinner first
    Replaces with data on success
    Shows error state on failure
    Never leaves blank space

DELIVERABLE:
  ‚úÖ All errors handled gracefully
  ‚úÖ No stack traces exposed
  ‚úÖ All empty states designed
  ‚úÖ All loading states present
```

---

### THURSDAY ‚Äî Cross Browser + Mobile Testing

```
ALL DAY:

TEST IN CHROME:
  ‚ñ° All 9 admin pages
  ‚ñ° All user pages
  ‚ñ° All downloads work
  ‚ñ° All charts render

TEST IN FIREFOX:
  ‚ñ° CSS renders correctly
  ‚ñ° Date inputs work
  ‚ñ° Fetch API works
  ‚ñ° All charts render

TEST IN SAFARI:
  ‚ñ° Date pickers work
  ‚ñ° CSS grid correct
  ‚ñ° No webkit breaks

TEST IN EDGE:
  ‚ñ° All pages load
  ‚ñ° Downloads work

MOBILE TEST (Chrome DevTools):
  ‚ñ° User pages responsive
  ‚ñ° Admin pages readable at 768px
  ‚ñ° Sidebar collapses on mobile
  ‚ñ° Tables scroll horizontally
  ‚ñ° Modals fit on screen
  ‚ñ° Buttons are touch-friendly

DELIVERABLE:
  ‚úÖ Works in all 4 browsers
  ‚úÖ Mobile responsive
  ‚úÖ No layout breaks at any size
```

---

### FRIDAY ‚Äî Final Deployment Checklist

```
ALL DAY:

PRODUCTION CHECKLIST:

ENV FILE:
  ‚ñ° JWT_SECRET_KEY = (64+ char random)
  ‚ñ° DATABASE_URL = (real PostgreSQL)
  ‚ñ° No test credentials in .env
  ‚ñ° .env added to .gitignore

DATABASE:
  ‚ñ° All migrations run
  ‚ñ° Admin user created
  ‚ñ° 30 food items seeded
  ‚ñ° Inventory rows seeded
  ‚ñ° Indexes created

BACKEND:
  ‚ñ° CORS locked to production domain
  ‚ñ° Rate limiting active
  ‚ñ° No debug mode in production
  ‚ñ° No console.log of sensitive data
  ‚ñ° All random() analytics removed
  ‚ñ° Fake JWT backdoor removed

FRONTEND:
  ‚ñ° API URLs use env variable or
    window.location.hostname
  ‚ñ° Not hardcoded to localhost
  ‚ñ° No TODO comments
  ‚ñ° No test credentials visible

TESTS:
  ‚ñ° Register ‚Üí Login ‚Üí Profile ‚Üí Order
  ‚ñ° Admin login ‚Üí all 9 pages
  ‚ñ° Order status change both ways
  ‚ñ° Food add ‚Üí visible on user menu
  ‚ñ° Audit logs for every action
  ‚ñ° Reports download all 3 types

DELIVERABLE:
  ‚úÖ Production checklist complete
  ‚úÖ Application deployment ready
  ‚úÖ Week 5 COMPLETE
  ‚úÖ FULL PROJECT COMPLETE üéâ
```

---
---

## üìä COMPLETE TIMELINE SUMMARY

```
WEEK 1 ‚Äî Fix Foundation
  Mon: PostgreSQL + database setup
  Tue: Fix all models
  Wed: Seed data + fix health route
  Thu: Fix menu + order routes
  Fri: Fix analytics + security

WEEK 2 ‚Äî Build Admin Backend
  Mon: Admin foundation + dashboard
  Tue: Foods + inventory routes
  Wed: Orders + users routes
  Thu: Analytics (all 10 endpoints)
  Fri: AI + Reports + Audit routes

WEEK 3 ‚Äî Connect Frontends
  Mon: Fix admin frontend URLs
  Tue: Fix login bridge
  Wed: Fix user frontend pages
  Thu: Integration testing (all 8 points)
  Fri: Bug fixes + RBAC testing

WEEK 4 ‚Äî Real AI + Intelligence
  Mon: Fix AI recommendation engine
  Tue: Fix chatbot intelligence
  Wed: Admin AI Monitoring live
  Thu: Reports + Audit verification
  Fri: Complete system test

WEEK 5 ‚Äî Production Hardening
  Mon: Security audit
  Tue: Performance optimization
  Wed: Error handling
  Thu: Cross-browser + mobile
  Fri: Final deployment checklist

TOTAL: 5 WEEKS
RESULT: Complete, integrated,
        production-ready application
```

---
